!function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===e(r)?r:String(r)}function r(e,r,n){return(r=t(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function n(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,u,"next",e)}function u(e){n(o,i,a,s,u,"throw",e)}s(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}function l(){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=c(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(this,arguments)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function f(t,r){if(r&&("object"===e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function m(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g={exports:{}},v={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(v),function(e){var t=v.exports.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new M(n||[]);return o(a,"_invoke",{value:D(e,r,s)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var p={};function m(){}function g(){}function v(){}var y={};h(y,u,(function(){return this}));var k=Object.getPrototypeOf,w=k&&k(k(C([])));w&&w!==i&&a.call(w,u)&&(y=w);var _=v.prototype=m.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,r){function n(i,o,s,u){var c=f(e[i],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==t(h)&&a.call(h,"__await")?r.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(h).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(e,t){function a(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(a,a):a()}})}function D(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return P()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=E(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var i=f(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function C(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(a.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=v,o(_,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:g,configurable:!0}),g.displayName=h(v,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,h(e,l,"GeneratorFunction")),e.prototype=Object.create(_),e},n.awrap=function(e){return{__await:e}},b(x.prototype),h(x.prototype,c,(function(){return this})),n.AsyncIterator=x,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new x(d(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(_),h(_,l,"Generator"),h(_,u,(function(){return this})),h(_,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(g);var y=g.exports(),k=y;try{regeneratorRuntime=y}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=y:Function("r","regeneratorRuntime = r")(y)}var w={},_={};Object.defineProperty(_,"__esModule",{value:!0});var b=function(){function e(){}return e.CHANNEL="mf_profiler",e}();_.default=b;var x,D,E={};x=E,Object.defineProperty(x,"__esModule",{value:!0}),x.EventStage=void 0,(D=x.EventStage||(x.EventStage={}))[D.START=0]="START",D[D.TRACK_START=1]="TRACK_START",D[D.TRACK_END=2]="TRACK_END",D[D.BOX_INFERENCE_START=3]="BOX_INFERENCE_START",D[D.BOX_INFERENCE_END=4]="BOX_INFERENCE_END",D[D.INFERENCE_START=5]="INFERENCE_START",D[D.INFERENCE_END=6]="INFERENCE_END",D[D.RENDER_START=7]="RENDER_START",D[D.RENDER_END=8]="RENDER_END",D[D.RESOURCE=9]="RESOURCE";var L={};Object.defineProperty(L,"__esModule",{value:!0}),L.safeBroadcastChannel=void 0;var S=function(){function e(){}return e.prototype.postMessage=function(e){},e.prototype.addEventListener=function(e,t){},e.prototype.close=function(){},e}();L.safeBroadcastChannel=function(e,t){void 0===t&&(t="PROD");var r=new S;return"undefined"!=typeof BroadcastChannel?r=new BroadcastChannel(e):"DEV"===t&&void 0!==console.info&&console.info("WebProfiler is not supported on your browser"),r};var M=(p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(_),C=E,P=L.safeBroadcastChannel(M.default.CHANNEL);function F(e,t){if(Object.values(C.EventStage).includes(e)){var r={time:performance.now(),stage:e,url:t};P.postMessage(r)}else console.log(e+" is not a valid event")}function O(e){console.warn(e)}function R(e){return T.apply(this,arguments)}function T(){return(T=i(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}function I(e){throw console.error(e),e}function j(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=document.createElement("canvas");if(n.width=e,n.height=t,n.style.background="rgb(255,255,255,0)",r){var i=n.getContext("2d");i.fillStyle=r,i.fillRect(0,0,e,t)}return n}void 0===window.mfBroadcast&&(window.mfBroadcast=function(e){},window.mfEnableProfiling=function(e,t,r){void 0===t&&(t="PROD"),window.mfBroadcast=F;var n={time:performance.now(),stage:C.EventStage.START,model:r,env:t,timer:e};P.postMessage(n)}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=_;Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}});var r=E;Object.defineProperty(e,"EventStage",{enumerable:!0,get:function(){return r.EventStage}});var n=L;Object.defineProperty(e,"safeBroadcastChannel",{enumerable:!0,get:function(){return n.safeBroadcastChannel}})}(w);var B={exports:{}};!function(e,t){!function(e){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==p?p:"undefined"!=typeof self?self:{},r={exports:{}};!function(e,t){!function(e){const t=Math.pow(1,-10);class r{constructor(e,t,r,n){this.x=e,this.y=t,this.width=r,this.height=n}round(){return new r(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height))}static intersect(e,t){const n=new r(0,0,0,0);n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y);const i=Math.min(e.x+e.width,t.x+t.width),a=Math.min(e.y+e.height,t.y+t.height);return n.width=i-n.x,n.height=a-n.y,n}static union(e,t){const n=new r(0,0,0,0),i=Math.min(e.x,t.x),a=Math.max(e.x+e.width,t.x+t.width),o=Math.min(e.y,t.y),s=Math.max(e.y+e.height,t.y+t.height);return n.x=i,n.y=o,n.width=a-i,n.height=s-o,n}static area(e){return e.width*e.height}static iou(e,t){const n=r.intersect(e,t),i=r.union(e,t);return this.area(n)/this.area(i)}static mix(e,t,r){return e*(1-r)+t*r}static iouAvgRect(e,t){const n=r.iou(e,t),i=r.mix(e.x,t.x,n),a=r.mix(e.y,t.y,n),o=r.mix(e.x+e.width,t.x+t.width,n),s=r.mix(e.y+e.height,t.y+t.height,n);return new r(i,a,o-i,s-a)}}class n{constructor(e=0,t=0){this.x=e,this.y=t}static fromObject(e){return e?new n(e.x||0,e.y||0):new n}add(e){return new n(this.x+e.x,this.y+e.y)}sub(e){return new n(this.x-e.x,this.y-e.y)}neg(){return new n(-this.x,-this.y)}multScalar(e){return new n(this.x*e,this.y*e)}divScalar(e){if(Math.abs(e)<t)throw new Error("divScalar: scalar is too close to 0.");return new n(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}normalized(){const e=this.norm();return e<t?new n(0,0):new n(this.x/e,this.y/e)}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}clone(){return new n(this.x,this.y)}setTo(e){this.x=e.x,this.y=e.y}}function i(e){let t=0,r=0;return e.forEach((({x:e,y:n})=>{t+=e,r+=n})),new n(t/e.length,r/e.length)}class a{constructor(){this.data=[]}writeZeroes(e){for(let t=0;t<e;t+=1)this.data.push(0)}write(e){this.data.push(e||0)}writeNumArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(t);for(let t=0;t<e.length;t+=1)this.write(e[t]);const r=t-e.length;this.writeZeroes(r)}writePoint(e){this.write(e.x),this.write(e.y)}writePointArray(e,t){if(null===e||0===e.length)return void this.writeZeroes(2*t);for(let t=0;t<e.length;t+=1)this.writePoint(e[t]);const r=t-e.length;this.writeZeroes(2*r)}toFloat32(){return new Float32Array(this.data)}toFloat64(){return new Float64Array(this.data)}}e.Color=class{constructor(e,t,r,n=255){this.r=e,this.g=t,this.b=r,this.a=n}},e.FacePoints=class{constructor(){this.outerMouth=null,this.innerMouth=null,this.leftEye=null,this.rightEye=null,this.leftBrow=null,this.rightBrow=null,this.nose=null,this.contour=null,this.foreheadPt=null,this.rightEye3D=[65.9,25.8,200.7],this.leftEye3D=[-65.9,25.8,200.7],this.nose3D=[0,-69.7,259.8],this.mouth3D=[0,-132.5,215.1],this.rightEyeInnerCorner3D=[32.6,27.1,196.5],this.leftEyeInnerCorner3D=[-32.6,27.1,196.5],this.rightEyeOuterCorner3D=[105.638,26.872,185.49],this.leftEyeOuterCorner3D=[-105.638,26.872,185.49],this.rightNose3D=[32.559,-20.731,206.171],this.leftNose3D=[-32.559,-20.731,206.171],this.modelMatrix=null,this.projectionViewMatrix=null,this.modelViewProjectionMatrix=null,this.faceRotation=[0,0,0],this.faceTranslation=[0,0,0]}static serialize(e){const t=new a;return t.writePointArray(e.outerMouth,13),t.writePointArray(e.innerMouth,8),t.writePointArray(e.leftEye,10),t.writePointArray(e.rightEye,10),t.writePointArray(e.leftBrow,7),t.writePointArray(e.rightBrow,7),t.writePointArray(e.nose,7),t.writePointArray(e.contour,3),t.writeNumArray([e.foreheadPt.x,e.foreheadPt.y],2),t.writeNumArray(e.faceRotation,3),t.writeNumArray(e.faceTranslation,3),t.writeNumArray(e.modelViewProjectionMatrix,12),t.writeNumArray(e.modelMatrix,16),t.writeNumArray(e.projectionViewMatrix,12),t.writeNumArray(e.rightEye3D,3),t.writeNumArray(e.leftEye3D,3),t.writeNumArray(e.nose3D,3),t.writeNumArray(e.mouth3D,3),t.writeNumArray(e.rightEyeInnerCorner3D,3),t.writeNumArray(e.leftEyeInnerCorner3D,3),t.writeNumArray(e.rightEyeOuterCorner3D,3),t.writeNumArray(e.leftEyeOuterCorner3D,3),t.writeNumArray(e.rightNose3D,3),t.writeNumArray(e.leftNose3D,3),new Uint8Array(t.toFloat32().buffer)}pose2DPoints(){const e=i(this.rightEye),t=i(this.leftEye),r=i(this.nose),n=i(this.outerMouth);return[e.x,e.y,t.x,t.y,r.x,r.y,n.x,n.y,this.rightEye[0].x,this.rightEye[0].y,this.leftEye[5].x,this.leftEye[5].y,this.rightEye[5].x,this.rightEye[5].y,this.leftEye[0].x,this.leftEye[0].y,this.nose[6].x,this.nose[6].y,this.nose[0].x,this.nose[0].y]}pose3DPoints(){return this.rightEye3D.concat(this.leftEye3D,this.nose3D,this.mouth3D,this.rightEyeInnerCorner3D,this.leftEyeInnerCorner3D,this.rightEyeOuterCorner3D,this.leftEyeOuterCorner3D,this.rightNose3D,this.leftNose3D)}},e.FloatWriter=a,e.PixelData=class{constructor(e,t,r){this.buffer=e,this.width=t,this.height=r}},e.Point=n,e.Rect=r,e.Timer=class{constructor(){this.reset()}reset(){this.startTime=(new Date).getTime()}timePassed(){return(new Date).getTime()-this.startTime}static measure(e){const t=(new Date).getTime();return e(),(new Date).getTime()-t}},e.assert=(e,t=null)=>{if(!e)throw console.error(t),new Error(`Assertion failed: ${t}`)},Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,r.exports);class n{constructor(){this.skinSmoothing=0,this.skinBrightening=0,this.skinGlow=0,this.shouldApplySkinEffectsToBaseLook=!1,this.intensity=1,this.nostrilThinning=0,this.noseBridgeThinning=0,this.jawSlimming=0,this.eyeHeightEnlarge=0,this.eyeWidthEnlarge=0,this.lipVolume=0,this.eyeEraseExpandFactor=.95}}class i{constructor(e,t,r,n,i){const a=(e,t)=>void 0!==e?e:t;this.r=a(e,0),this.g=a(t,0),this.b=a(r,0),this.a=255,this.amount=a(n,1),this.gloss=a(i,0),this.glitter=0,this.glitterDensity=1,this.glitterColorR=255,this.glitterColorG=255,this.glitterColorB=255,this.useDynamicColor=!0,this.contrastBoost=0,this.skinClearing=0,this.skinGlow=0,this.isSkinGlowDynamicByRotation=!0,this.glitterSize=1,this.glitterBaseReflectivity=.3,this.glitterColorVariation=0,this.glitterSizeVariation=0,this.glossDetail=0,this.wetness=0,this.envMappingIntensity=0,this.envMappingR=255,this.envMappingG=255,this.envMappingB=255,this.envMappingRotationY=0,this.envMappingCurve=2.3,this.envMappingBumpIntensity=0,this.metallicIntensity=0,this.metallicRoughness=0,this.matteness=0,this.vinylIntensity=0,this.textureBoost=0,this.lustre=0,this.opaqueness=0}}const a={data:{blush:["apple","apple2","apple2_intense","apple_blended","apple_blended_intense","apple_intense","cheekbone","cheekbone_intense","contour","default_intense","full_cheek","full_cheek_intense","lower_cheek","lower_cheek_intense","none","upper_cheek","upper_cheek_intense","default"],brow:["default"],concealer:["default"],contour:["forehead_side","forehead_side2","highlight","default","inner_eyebrow"],cushion:["default"],eyeliner:["angular_both","angular_top","Bold_eyeliner_both","Bold_eyeliner_top","butterfly_liner_both","butterfly_liner_top","butterfly_mask_both","butterfly_mask_top","cateye2_both","cateye2_top","cateye_both","cateye_top","cheetah_mask_both","cheetah_mask_top","cheetah_winged_both","cheetah_winged_top","Confident_eyeliner_both","Confident_eyeliner_top","crease_box_both","crease_box_top","crease_flare_both","crease_flare_top","crease_simple_long_both","crease_simple_long_top","crease_simple_short_both","crease_simple_short_top","double_winged_both","double_winged_top","elongated_bottom_both","elongated_bottom_top","extrasmallwinged_both","extrasmallwinged_top","fashion_look2_eyeliner_both","fashion_look2_eyeliner_top","GetTheLook_look1_eyeliner_both","GetTheLook_look1_eyeliner_top","GetTheLook_look3_eyeliner_both","GetTheLook_look3_eyeliner_top","halloween1_both","halloween1_top","halloween2_both","halloween2_top","halloween3_both","halloween3_top","halloween4_both","halloween4_top","halloween5_both","halloween5_top","innermid_crease_both","innermid_crease_top","kaja_both","kaja_top","kohl_both","kohl_top","la_inner_winged_both","la_inner_winged_top","la_mask_both","la_mask_top","la_middle_winged_both","la_middle_winged_top","la_outer_winged_both","la_outer_winged_top","MNY_FashionWeek_look1_liner1_both","MNY_FashionWeek_look1_liner1_top","MNY_FashionWeek_look1_liner2_both","MNY_FashionWeek_look1_liner2_top","MNY_FashionWeek_look1_liner3_both","MNY_FashionWeek_look1_liner3_top","MNY_Holiday_look1_eyeliner_crease_both","MNY_Holiday_look1_eyeliner_crease_top","MNY_Holiday_look2_eyeliner_outer_both","MNY_Holiday_look2_eyeliner_outer_top","MNY_Holiday_look2_eyeliner_under_both","MNY_Holiday_look2_eyeliner_under_top","natural2_both","natural2_top","natural_both","natural_top","none_both","none_top","OAP_Halloween2020_look1_both","OAP_Halloween2020_look1_top","OAP_Halloween2020_look2_both","OAP_Halloween2020_look2_top","OAP_Halloween2020_look3_both","OAP_Halloween2020_look3_top","OAP_Halloween2020_look4_both","OAP_Halloween2020_look4_top","Powerful_eyeliner_both","Powerful_eyeliner_top","prima_ballerina_liner_both","prima_ballerina_liner_top","puppyeye_both","puppyeye_top","sharpwinged_inner_both","sharpwinged_inner_top","sharpwinged_outer_both","sharpwinged_outer_top","smallwinged_both","smallwinged_top","smokeyfull_both","smokeyfull_top","smoky2_both","smoky2_top","smokynautral_both","smokynautral_top","smoky_both","smoky_top","smudged_bottom_both","smudged_bottom_top","smudged_winged_both","smudged_winged_top","subtle_both","subtle_top","swoop_winged_liner_both","swoop_winged_liner_top","tear_both","tear_top","thick_winged_crease_both","thick_winged_crease_top","top_both","top_top","waterline_both","waterline_thick_both","waterline_thick_top","waterline_top","winged2_both","winged2_top","wingedsimple_both","wingedsimple_top","wingedthick_both","wingedthick_top","wingedthin_both","wingedthin_top","winged_both","winged_crease2_both","winged_crease2_top","winged_crease_both","winged_crease_top","winged_top"],eyeshadow:["angular_full","angular_liner","angular_overlay","Asian_1color","Asian_2color_A1","Asian_2color_A2","Asian_2color_B1","Asian_2color_B2","Asian_3color_A1","Asian_3color_A2","Asian_3color_A3","Asian_3color_B1","Asian_3color_B2","Asian_3color_B3","Azuki_Look_1","Azuki_Look_2","below_iris","black","bluelook1_a","bluelook1_b","bluelook1_b1","bluelook1_b2","bluelook1_c","bluelook2_a","bluelook2_b","bluelook2_c","bluelook2_eyebrow","bluelook3_a","bluelook3_b","bluelook3_c","bronze","browline2","butterfly_inner","center","centre_lid","cheetah_lid","cleopatra2_liner","colourqueenlook1_part1","colourqueenlook1_part2","colourqueenlook3_part1","colourqueenlook3_part2","Confident_eyeshadow","contour","crease3","deep_aqua","deep_blue","deep_blue_2","deep_blue_fade","elongated_bottom_liner","elongated_lid","energeticorange_part1","energeticorange_part2","energeticorange_part3","energeticorange_part4","eyegowild_look2_lower","eyegowild_look2_upper","eyegowild_look4","eyegowild_look4_liner","eyegowild_look5_liner","eyegowild_look5_lower","eyegowild_look5_upper","eyegowild_look6","eyegowild_look6_liner","fashion_look1_part1","fashion_look1_part2","fashion_look2_part1","fashion_look2_part2","fashion_look3_part1","fashion_look3_part2","fashion_look4_part1","fashion_look4_part2","framed","full_lid3","GetTheLook_look1_eyeshadow1","GetTheLook_look1_eyeshadow2","GetTheLook_look1_eyeshadow3","GetTheLook_look1_eyeshadow4","GetTheLook_look2_eyeshadow1","GetTheLook_look2_eyeshadow2","GetTheLook_look3_eyeshadow","gold","Graphic_3_Liner","green","half_inner_lid","halloween1","halloween2","halloween3","indigomotion_part1","indigomotion_part2","indigomotion_part3","indigomotion_part4","innercorner","innermid_crease_liner","la_tear","light_blue","lowerlash2","lowerlash_thick","MNY_FashionWeek_look1_shadow1","MNY_FashionWeek_look1_shadow2","MNY_FashionWeek_look1_shadow3","MNY_Holiday_look1_eyeshadow_crease","MNY_Holiday_look2_eyeshadow_outer","MNY_Holiday_look2_eyeshadow_under","natural_liner","none","OP_look1_CS1","OP_look1_M3","OP_look1_ME5","OP_look1_ME6","OP_look2_CS1","OP_look2_P1","OP_look3_CS1","OP_look3_ME4","OP_look3_P1","OP_look4_ME6","OP_look4_P2","OP_look5_CS1","OP_look5_M3","OP_look5_M5","OP_look5_P4","OP_look6_CS1","OP_look6_M4","OP_look6_ME5","OP_look6_P3","OP_look7_G1","OP_look7_P1","OP_look7_PR1","OP_look8_G1","OP_look8_ME2","OP_look8_ME4","orangelook4_a","orangelook4_b","orangelook4_c","orangelook5_a","orangelook5_b","orangelook5_c","orangelook5_eyebrow","orangelook6_a","orangelook6_b","orangelook6_c","outer_corner_framed","outer_half_top","Powerful_eyeshadow_part1","Powerful_eyeshadow_part2","prima_ballerina_shadow","sharplid_full","sharp_lid2","side_crease","side_lid","sportykick_part1","sportykick_part2","sportykick_part3","sportykick_part4","summerpunch_part1","summerpunch_part2","summerpunch_part3","summerpunch_part4","tokyosunrise_part1","tokyosunrise_part2","tokyosunrise_part3","tokyosunrise_part4","winged_crease","default","full_lid","outer","inner","crease","brow_highlight","full_lid2","outer2","tear","crease2","browline","lowerlash","innerhalf","outerhalf","rectangular","smokycateye","fullcateye","cleopatra1","cleopatra2","full_smoky_lid","full_smoky_winged","fulllid_winged","innerlid","sharp_crease","sharp_lid","sharpinner_lid","sharpouter_corner","sharpwinged_inner","sharpwinged_outer"],foundation:["default"],highlight:["cheek1","cheek2","cheek3","cheek4","chin","contour","cupidsbow","eyebrow","forehead","glow1_cherie","glow2_monamour","glow3_lavieenglow","glow3_lavieenglow2","glow4_sorbet","nose1","nose2","nose3","upperlip","default"],lipcolor:["inner_horizontal","inner_vertical","outer_horizontal","outer_vertical","default"],lipliner:["default"],mascara:["doll","doll_2","doll_2_full","drama","drama_full","extreme","extreme_full","fashion_look2_lash","FA_Asia_2_4","FA_Asia_2_5","grandiose","grandiose_full","idole_lash","length","lower","natural","naturallength","naturallength_2","naturalvolume","naturalvolumelength","naturalvolumelength_lower","naturalvolume_lower","naturalwhispy","naturalwhispy_lower","natural_2","natural_2_full","none","prima_ballerina_bottom_mascara","prima_ballerina_top_mascara","subtle","subtle_full","volume","volumelength","volume_2","volume_2_full"],primer:["default"],settingspray:["default"]}};function o(e){return a.data[e]}function s(e){return o(e).reduce(((t,r)=>{const n=t;return n[r]=`${e}_${r}.png`,n}),{})}const u=Object.assign(Object.assign(Object.assign({blush:"blush.png",highlight:"highlight.png",contour:"contour.png",overlay:"white.png"},s("blush")),s("contour")),s("highlight")),c=[...o("blush"),...o("contour"),...o("highlight")],l=Object.assign({},s("eyeliner")),h=[...o("eyeliner")],d=Object.assign({},s("eyeshadow")),f=[...o("eyeshadow")],m=Object.assign({},s("lipcolor")),g=[...o("lipcolor")],v=Object.assign({},s("mascara")),y=[...o("mascara")];class k{constructor(e){this.product=e||null}}class w extends k{constructor(e,t,r){super(e),this.blendMode="makeup",this.targetSide="both",this.maskImagePath=t,this.maskImageSize=r}}class _ extends k{constructor(e,t="default",r="full"){super(e),this.presetStyle="default",this.placement="full",this.blurFactor=1.3,this.blurFactorInner=1.3,this.lipMeshNumRowsUpper=0,this.lipMeshNumColsUpper=0,this.lipMeshNumRowsLower=0,this.lipMeshNumColsLower=0,this.presetStyle=t,this.placement=r}}class b extends w{constructor(e,t,n=null,i={width:250,height:188}){let a=n;a||(a=`Eyeliner/${l[t]?l[t]:l.natural_top}`),super(e,a,i),this.presetStyle=t,this.referenceEyePoints=[new r.exports.Point(78,120),new r.exports.Point(136,103),new r.exports.Point(191,136),new r.exports.Point(138,137)]}}class x extends w{constructor(e,t,n=null,i={width:200,height:131}){let a=n;a||(a=`Mascara/${v[t]?v[t]:v.natural}`),super(e,a,i),this.presetStyle=t,this.referenceEyePoints=[new r.exports.Point(53,75),new r.exports.Point(117,55),new r.exports.Point(182,93),new r.exports.Point(117,91)]}}class D extends w{constructor(e,t,n=null,i={width:250,height:188}){let a=n;a||(a=`Eyeshadow/${d[t]?d[t]:d.full_lid}`),super(e,a,i),this.presetStyle=t,this.referenceEyePoints=[new r.exports.Point(78,118),new r.exports.Point(136,102),new r.exports.Point(199,133),new r.exports.Point(138,143)],this.referenceBrowPoints=[new r.exports.Point(14,65),new r.exports.Point(84,38),new r.exports.Point(215,65)],this.deformationAreaFactor=2}}class E extends w{constructor(e,t,r=null,n={width:180,height:195}){let i=r;i||(i=`Blush/${u[t]?u[t]:u.blush}`),super(e,i,n),this.presetStyle=t}}class L extends w{constructor(e,t,r=null,n={width:180,height:195}){const i={default:"concealer_mask.png",overlay:"white.png"};let a=r;a||(a=`Concealer/${i[t]?i[t]:i.blush}`),super(e,a,n),this.presetStyle=t}}class S extends w{constructor(e,t,r){super(e,t,{width:0,height:0}),this.maskJSONPath=r}}class M extends S{constructor(e,t,r){super(e,t,r),this.eraseAmount=1}}class C{constructor(e){this.outerAlign=0,this.outerVertAlign=0,this.innerAlign=0,this.innerVertAlign=0,this.localArchPull=0,this.localArchPullPointiness=0,this.globalArchPull=0,this.innerThickness=0,this.middleThickness=0,this.outerThickness=0,this.cleaningTop=0,this.cleaningBottom=0,this.cleaningInnerVertical=0,this.cleaningInnerRoundness=0,this.horizontalShift=0,this.verticalShift=0,e&&(e.outer_alignment_hor&&(this.outerAlign=e.outer_alignment_hor),e.outer_alignment_ver&&(this.outerVertAlign=e.outer_alignment_ver),e.inner_alignment_hor&&(this.innerAlign=e.inner_alignment_hor),e.inner_alignment_ver&&(this.innerVertAlign=e.inner_alignment_ver),e.arch_pull&&(this.localArchPull=e.arch_pull),e.j_pull&&(this.globalArchPull=e.j_pull),e.inner_thickness&&(this.innerThickness=e.inner_thickness),e.middle_thickness&&(this.middleThickness=e.middle_thickness),e.outer_thickness&&(this.outerThickness=e.outer_thickness),e.cleaning_top&&(this.cleaningTop=e.cleaning_top),e.cleaning_bottom&&(this.cleaningBottom=e.cleaning_bottom),e.cleaning_vertical&&(this.cleaningInnerVertical=e.cleaning_vertical),e.cleaning_inner_roundness&&(this.cleaningInnerRoundness=e.cleaning_inner_roundness))}}class P{constructor(e){if(this.colorR=0,this.colorG=0,this.colorB=0,this.colorAmount=0,this.sparkleIntensity=0,this.sparkleR=255,this.sparkleG=255,this.sparkleB=255,this.sparkleDensity=.5,this.sparkleSize=1,this.sparkleColorVariation=0,this.sparkleSizeVariation=0,this.sparkleBaseReflectivity=.3,e&&(e.color_r&&(this.colorR=e.color_r),e.color_g&&(this.colorG=e.color_g),e.color_b&&(this.colorB=e.color_b),e.color_a)){const t=e.color_a/255,r=(e.intensity-e.intensity_lower)/(e.intensity_upper-e.intensity_lower);this.colorAmount=t*r}}}class F{constructor(e){this.overlayAmount=0,this.topExpansion=0,this.bottomExpansion=0,this.side="left",e&&e.overlay&&(e.overlay.mask&&(this.overlayImagePath=`brow_overlay/${e.overlay.mask}`),e.overlay.points&&(this.referenceBrowPoints=e.overlay.points),e.overlay_amount&&(this.overlayAmount=e.overlay_amount))}}class O{constructor(e){this.powderIntensity=0,this.coloringParams=new P(e),this.warpingParams=new C(e),this.fillOverlayParams=new F(e)}}class R extends S{}class T extends k{}var A={exports:{}};!function(e,r){var n="__lodash_hash_undefined__",i=9007199254740991,a="[object Arguments]",o="[object Boolean]",s="[object Date]",u="[object Function]",c="[object GeneratorFunction]",l="[object Map]",h="[object Number]",d="[object Object]",f="[object Promise]",p="[object RegExp]",m="[object Set]",g="[object String]",v="[object Symbol]",y="[object WeakMap]",k="[object ArrayBuffer]",w="[object DataView]",_="[object Float32Array]",b="[object Float64Array]",x="[object Int8Array]",D="[object Int16Array]",E="[object Int32Array]",L="[object Uint8Array]",S="[object Uint8ClampedArray]",M="[object Uint16Array]",C="[object Uint32Array]",P=/\w*$/,F=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,R={};R[a]=R["[object Array]"]=R[k]=R[w]=R[o]=R[s]=R[_]=R[b]=R[x]=R[D]=R[E]=R[l]=R[h]=R[d]=R[p]=R[m]=R[g]=R[v]=R[L]=R[S]=R[M]=R[C]=!0,R["[object Error]"]=R[u]=R[y]=!1;var T="object"==typeof t&&t&&t.Object===Object&&t,A="object"==typeof self&&self&&self.Object===Object&&self,I=T||A||Function("return this")(),j=r&&!r.nodeType&&r,B=j&&e&&!e.nodeType&&e,N=B&&B.exports===j;function z(e,t){return e.set(t[0],t[1]),e}function H(e,t){return e.add(t),e}function W(e,t,r,n){var i=-1,a=e?e.length:0;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}function V(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function U(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function G(e,t){return function(r){return e(t(r))}}function Y(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var $,q=Array.prototype,K=Function.prototype,J=Object.prototype,Q=I["__core-js_shared__"],X=($=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"",Z=K.toString,ee=J.hasOwnProperty,te=J.toString,re=RegExp("^"+Z.call(ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=N?I.Buffer:void 0,ie=I.Symbol,ae=I.Uint8Array,oe=G(Object.getPrototypeOf,Object),se=Object.create,ue=J.propertyIsEnumerable,ce=q.splice,le=Object.getOwnPropertySymbols,he=ne?ne.isBuffer:void 0,de=G(Object.keys,Object),fe=Be(I,"DataView"),pe=Be(I,"Map"),me=Be(I,"Promise"),ge=Be(I,"Set"),ve=Be(I,"WeakMap"),ye=Be(Object,"create"),ke=Ve(fe),we=Ve(pe),_e=Ve(me),be=Ve(ge),xe=Ve(ve),De=ie?ie.prototype:void 0,Ee=De?De.valueOf:void 0;function Le(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Se(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Me(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){this.__data__=new Se(e)}function Pe(e,t){var r=Ge(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ye(e)}(e)&&ee.call(e,"callee")&&(!ue.call(e,"callee")||te.call(e)==a)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!t&&!ee.call(e,o)||i&&("length"==o||He(o,n))||r.push(o);return r}function Fe(e,t,r){var n=e[t];ee.call(e,t)&&Ue(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function Oe(e,t){for(var r=e.length;r--;)if(Ue(e[r][0],t))return r;return-1}function Re(e,t,r,n,i,f,y){var F;if(n&&(F=f?n(e,i,f,y):n(e)),void 0!==F)return F;if(!Ke(e))return e;var O=Ge(e);if(O){if(F=function(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&ee.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!t)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,F)}else{var T=ze(e),A=T==u||T==c;if($e(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if(T==d||T==a||A&&!f){if(V(e))return f?e:{};if(F=function(e){return"function"!=typeof e.constructor||We(e)?{}:Ke(t=oe(e))?se(t):{};var t}(A?{}:e),!t)return function(e,t){return Ie(e,Ne(e),t)}(e,function(e,t){return e&&Ie(t,Je(t),e)}(F,e))}else{if(!R[T])return f?e:{};F=function(e,t,r,n){var i,a=e.constructor;switch(t){case k:return Ae(e);case o:case s:return new a(+e);case w:return function(e,t){var r=t?Ae(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case _:case b:case x:case D:case E:case L:case S:case M:case C:return function(e,t){var r=t?Ae(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case l:return function(e,t,r){return W(t?r(U(e),!0):U(e),z,new e.constructor)}(e,n,r);case h:case g:return new a(e);case p:return function(e){var t=new e.constructor(e.source,P.exec(e));return t.lastIndex=e.lastIndex,t}(e);case m:return function(e,t,r){return W(t?r(Y(e),!0):Y(e),H,new e.constructor)}(e,n,r);case v:return i=e,Ee?Object(Ee.call(i)):{}}}(e,T,Re,t)}}y||(y=new Ce);var I=y.get(e);if(I)return I;if(y.set(e,F),!O)var j=r?function(e){return function(e,t,r){var n=t(e);return Ge(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Je,Ne)}(e):Je(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););}(j||e,(function(i,a){j&&(i=e[a=i]),Fe(F,a,Re(i,t,r,n,a,e,y))})),F}function Te(e){return!(!Ke(e)||(t=e,X&&X in t))&&(qe(e)||V(e)?re:F).test(Ve(e));var t}function Ae(e){var t=new e.constructor(e.byteLength);return new ae(t).set(new ae(e)),t}function Ie(e,t,r,n){r||(r={});for(var i=-1,a=t.length;++i<a;){var o=t[i],s=n?n(r[o],e[o],o,r,e):void 0;Fe(r,o,void 0===s?e[o]:s)}return r}function je(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function Be(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Te(r)?r:void 0}Le.prototype.clear=function(){this.__data__=ye?ye(null):{}},Le.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Le.prototype.get=function(e){var t=this.__data__;if(ye){var r=t[e];return r===n?void 0:r}return ee.call(t,e)?t[e]:void 0},Le.prototype.has=function(e){var t=this.__data__;return ye?void 0!==t[e]:ee.call(t,e)},Le.prototype.set=function(e,t){return this.__data__[e]=ye&&void 0===t?n:t,this},Se.prototype.clear=function(){this.__data__=[]},Se.prototype.delete=function(e){var t=this.__data__,r=Oe(t,e);return!(r<0||(r==t.length-1?t.pop():ce.call(t,r,1),0))},Se.prototype.get=function(e){var t=this.__data__,r=Oe(t,e);return r<0?void 0:t[r][1]},Se.prototype.has=function(e){return Oe(this.__data__,e)>-1},Se.prototype.set=function(e,t){var r=this.__data__,n=Oe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},Me.prototype.clear=function(){this.__data__={hash:new Le,map:new(pe||Se),string:new Le}},Me.prototype.delete=function(e){return je(this,e).delete(e)},Me.prototype.get=function(e){return je(this,e).get(e)},Me.prototype.has=function(e){return je(this,e).has(e)},Me.prototype.set=function(e,t){return je(this,e).set(e,t),this},Ce.prototype.clear=function(){this.__data__=new Se},Ce.prototype.delete=function(e){return this.__data__.delete(e)},Ce.prototype.get=function(e){return this.__data__.get(e)},Ce.prototype.has=function(e){return this.__data__.has(e)},Ce.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Se){var n=r.__data__;if(!pe||n.length<199)return n.push([e,t]),this;r=this.__data__=new Me(n)}return r.set(e,t),this};var Ne=le?G(le,Object):function(){return[]},ze=function(e){return te.call(e)};function He(e,t){return!!(t=null==t?i:t)&&("number"==typeof e||O.test(e))&&e>-1&&e%1==0&&e<t}function We(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||J)}function Ve(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ue(e,t){return e===t||e!=e&&t!=t}(fe&&ze(new fe(new ArrayBuffer(1)))!=w||pe&&ze(new pe)!=l||me&&ze(me.resolve())!=f||ge&&ze(new ge)!=m||ve&&ze(new ve)!=y)&&(ze=function(e){var t=te.call(e),r=t==d?e.constructor:void 0,n=r?Ve(r):void 0;if(n)switch(n){case ke:return w;case we:return l;case _e:return f;case be:return m;case xe:return y}return t});var Ge=Array.isArray;function Ye(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}(e.length)&&!qe(e)}var $e=he||function(){return!1};function qe(e){var t=Ke(e)?te.call(e):"";return t==u||t==c}function Ke(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Je(e){return Ye(e)?Pe(e):function(e){if(!We(e))return de(e);var t=[];for(var r in Object(e))ee.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return Re(e,!0,!0)}}(A,A.exports);var I,j=A.exports;function B(e,t,r){void 0!==e[t]&&(e[r]=e[t],delete e[t])}function N(e){return"number"==typeof e}function z(e,t,r,n,i="overwrite"){const a=e[t];N(a)&&(r[n]&&"max"===i?r[n]=Math.max(r[n],a):r[n]=a)}function H(e,t){if(!e)return t;const r="Style",n=e.indexOf(r);if(-1===n)return console.warn(`presetStyle '${e}' cannot be converted`),t;const i=e.substring(n+r.length);return i.charAt(0).toLowerCase()+i.slice(1)}function W(e,t,r){return t&&t in e?e[t]:r}function V(e,t){return e&&e.includes("|")?"both":W({MFEMakeupLayerSideNone:"none",MFEMakeupLayerSideLeft:"left",MFEMakeupLayerSideRight:"right",MFEMakeupLayerSideBoth:"both"},e,t)}function U(e){if(!e)return null;const t=new i;return Object.assign(t,e),B(t,"colorR","r"),B(t,"colorG","g"),B(t,"colorB","b"),B(t,"colorA","a"),B(t,"intensity","amount"),B(t,"sparkleIntensity","glitter"),B(t,"sparkleDensity","glitterDensity"),B(t,"sparkleR","glitterColorR"),B(t,"sparkleG","glitterColorG"),B(t,"sparkleB","glitterColorB"),B(t,"sparkleSize","glitterSize"),B(t,"sparkleBaseReflectivity","glitterBaseReflectivity"),B(t,"sparkleColorVariation","glitterColorVariation"),B(t,"sparkleSizeVariation","glitterSizeVariation"),t}function G(e){if(!e)return null;const t=new F;return Object.assign(t,e),t.side=W({Left:"left",Right:"right"},e.side,"left"),t}function Y(e){const t=new O;return e&&e.params?(t.coloringParams=function(e){if(!e)return null;const t=new P;return Object.assign(t,e),e.colorA&&(t.colorAmount=e.colorA/255),t}(e.params.coloringParams),t.overlayParams=G(e.params.overlayParams),t.fillOverlayParams=G(e.params.fillOverlayParams),"powderIntensity"in e.params&&(t.powderIntensity=e.params.powderIntensity),t):t}function $(e,t="custom",n="MakeupLayer"){var i;if(!e)return null;const a=(e,t)=>{t.blendMode=W({MFEMakeupLayerBlendModeMakeup:"makeup",MFEMakeupLayerBlendModeAlphaBlend:"alphaBlend",MFEMakeupLayerBlendModeMakeupBlend:"makeupBlend",MFEMakeupLayerBlendModeSolidColorBlend:"solidColorBlend"},e.blendMode,"makeup"),t.sourceSide=V(e.sourceSide,"left"),t.targetSide=V(e.targetSide,"both")};function o(e,t,n){void 0!==e[n]&&(t[n]=e[n].map((e=>new r.exports.Point(e.x,e.y))))}const s=U(e.product);switch(null!==(i=e.class)&&void 0!==i?i:n){case"MakeupLayer":return new k(s);case"MakeupMaskLayer":{const t=e,r=new w(s,t.maskImagePath,t.maskImageSize);return a(t,r),r}case"MakeupLipLayer":{const r=e,n=new _(s,H(r.presetStyle,t),W({MFEMakeupLipstickPlacementFull:"full",MFEMakeupLipstickPlacementInnerHorizontal:"innerHorizontal",MFEMakeupLipstickPlacementOuterHorizontal:"outerHorizontal",MFEMakeupLipstickPlacementInnerVertical:"innerVertical",MFEMakeupLipstickPlacementOuterVertical:"outerVertical"},r.placement,"full"));return z(r,"blurFactor",n,"blurFactor"),z(r,"blurFactorInner",n,"blurFactorInner"),n}case"MakeupEyeLinerLayer":{const r=e,n=new b(s,H(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return a(r,n),void 0!==r.referenceEyePoints?(delete n.referenceEyePointsFull,o(r,n,"referenceEyePoints")):void 0!==r.referenceEyePointsFull&&(delete n.referenceEyePoints,o(r,n,"referenceEyePointsFull")),n}case"MakeupMascaraLayer":{const r=e,n=new x(s,H(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return a(r,n),o(r,n,"referenceEyePoints"),n}case"MakeupEyeShadowLayer":{const r=e,n=new D(s,H(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return a(r,n),z(r,"deformationAreaFactor",n,"deformationAreaFactor"),o(r,n,"referenceEyePoints"),o(r,n,"referenceBrowPoints"),n}case"MakeupBlushLayer":{const r=e,n=new E(s,H(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return a(r,n),z(r,"offsetX",n,"offsetX"),z(r,"offsetY",n,"offsetY"),z(r,"scaleX",n,"scaleX"),z(r,"scaleY",n,"scaleY"),n}case"MakeupConcealerLayer":{const r=e,n=new L(s,H(r.presetStyle,t),r.maskImagePath,r.maskImageSize);return a(r,n),z(r,"offsetX",n,"offsetX"),z(r,"offsetY",n,"offsetY"),z(r,"scaleX",n,"scaleX"),z(r,"scaleY",n,"scaleY"),n}case"MakeupDeformableFoundationLayer":{const t=e,r=j(t);return r.product=s,a(t,r),r}case"DeformableCustomLayer":{const t=e,r=new S(s,t.maskImagePath,t.maskJsonPath);return a(t,r),z(t,"maxCols",r,"maxCols"),z(t,"maxRows",r,"maxRows"),r}case"MakeupEraseDeformableCustomLayer":{const t=e,r=new M(s,t.maskImagePath,t.maskJsonPath);return a(t,r),z(t,"maxCols",r,"maxCols"),z(t,"maxRows",r,"maxRows"),z(t,"eraseAmount",r,"eraseAmount"),r}case"MakeupDeformableCustomLayer":{const t=e,r=new R(s,t.maskImagePath,t.maskJsonPath);return void 0!==t.eraseMasks&&(r.eraseMasks=t.eraseMasks.map((e=>$(e,"default","MakeupEraseDeformableCustomLayer")))),r}case"MakeupFoundationLayer":{const t=e,r=new T(s);return void 0!==t.shadeMatchedProduct&&(r.shadeMatchedProduct=U(t.shadeMatchedProduct)),r}default:return null}}function q(e,t="custom",r="MakeupLayer"){return e?e.map((e=>$(e,t,r))):null}function K(e){return JSON.stringify(e)}function J(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}class Q{constructor(e){this.loadHandlerType=null,this.resourceURL=e}}class X extends Q{constructor(e,t,r){super(e),this.loadHandlerType="image",this.isGrayscale=t,this.isBuiltIn=r}}class Z extends X{constructor(e,t,r,n){super(Z.filenameForParams(e,t,r,n),!1,!0),this.loadHandlerType="glitter",this.spread=e,this.density=t,this.size=r,this.sizeVariation=n}static filenameForParams(e,t,r,n){return`glitter-${e.toFixed(2)}-${t.toFixed(2)}-${r.toFixed(2)}-${n.toFixed(2)}.png`}}class ee extends Q{constructor(){super(...arguments),this.loadHandlerType="json"}}function te(e){return void 0!==e.maskJSONPath}function re(e,t,n){const i=(e,t,n,i)=>{r.exports.assert(n>t),r.exports.assert(i>1);const a=Math.min(Math.max(e,t),n),o=(n-t)/i;return Math.round((a-t)/o)*o+t};return{density:i(null!=e?e:1,.1,1,6),size:i(null!=t?t:1,1,10,18),sizeVariation:i(null!=n?n:0,0,1,5)}}function ne(e,t,r,n,i){return e>.001?new Z(t,r,n,i):null}function ie(e){const t=[],r=(e,r=1)=>{if(function(e){return void 0!==e.maskImagePath}(e)&&e.maskImagePath&&e.maskImagePath.length>0){const r=!e.blendMode||"makeup"===e.blendMode||"solidColorBlend"===e.blendMode;t.push(new X(e.maskImagePath,r,!1)),"makeupBlend"!==e.blendMode&&"alphaBlend"!==e.blendMode||t.push(new X("white.png",!0,!0))}if(e.product){!function(e){const t=re(e.glitterDensity,e.glitterSize,e.glitterSizeVariation);e.glitterDensity=t.density,e.glitterSize=t.size,e.glitterSizeVariation=t.sizeVariation}(e.product);const a=(i=r,ne((n=e.product).glitter,i,n.glitterDensity,n.glitterSize,n.glitterSizeVariation));a&&t.push(a)}var n,i},n=e=>{let r=!1;if(e.fillOverlayParams&&e.fillOverlayParams.overlayImagePath&&e.fillOverlayParams.overlayImagePath.length>0&&(r=!0,t.push(new X(e.fillOverlayParams.overlayImagePath,!1,!1))),e.overlayParams&&e.overlayParams.overlayImagePath&&e.overlayParams.overlayImagePath.length>0&&(r=!0,t.push(new X(e.overlayParams.overlayImagePath,!1,!1))),e.coloringParams){const r=1;!function(e){const t=re(e.sparkleDensity,e.sparkleSize,e.sparkleSizeVariation);e.sparkleDensity=t.density,e.sparkleSize=t.size,e.sparkleSizeVariation=t.sizeVariation}(e.coloringParams);const a=(i=r,ne((n=e.coloringParams).sparkleIntensity,i,n.sparkleDensity,n.sparkleSize,n.sparkleSizeVariation));a&&t.push(a)}var n,i;r&&t.push(new X("white.png",!0,!0))},i=e=>{e.maskJSONPath&&e.maskJSONPath.length>0&&t.push(new ee(e.maskJSONPath))},a=(e,r)=>{var n,i;if((null===(n=e.product)||void 0===n?void 0:n.skinGlow)>0)if(t.push(new X("white.png",!0,!0)),null===(i=e.product)||void 0===i?void 0:i.isSkinGlowDynamicByRotation)t.push(new X("Foundation/FoundationGlow_June4-2020_v2.png",!1,!0)),t.push(new X("Foundation/normal_map7_v1.png",!1,!0));else{const e=r?"Foundation/radiantsettingspray_mask.png":"Foundation/GlowMasksCropped2.png";t.push(new X(e,!1,!0))}},o=e=>{r(e),i(e),e.eraseMasks&&e.eraseMasks.forEach((e=>{r(e),i(e)}))},s=e=>{e.forEach((e=>{r(e)}))};if(e.blushLayers&&e.blushLayers.forEach((e=>{r(e),t.push(new X("Blush/blush_drop_4_sub_left_2.png",!0,!0)),te(e)&&o(e)})),e.eyeLinerLayers&&(e.eyeLinerLayers.forEach((e=>{r(e),te(e)&&o(e)})),e.eyeLinerLayers.some((e=>{var t,r;return(null===(t=e.product)||void 0===t?void 0:t.metallicIntensity)>0||(null===(r=e.product)||void 0===r?void 0:r.vinylIntensity)>0})))){const e=["Eyeliner/metalliceyeliner_normalmap.png","metalliceye_masknormal.png","metalliceye_masknormal_rgb.png","metalliceye_masknormal_alpha.png","metalliceye_mask_delta_uv.png","Eyeliner/vinyleyeliner_normalmap.png","Eyeliner/vinyleyeliner_directlightreflectivity_opaque.png"].map((e=>new X(e,!1,!0)));t.push(...e)}if(e.mascaraLayers&&e.mascaraLayers.forEach((e=>{r(e),te(e)&&o(e)})),e.eyeShadowLayers){e.eyeShadowLayers.forEach((e=>{r(e),te(e)&&o(e)}));const n=[],i=[];e.eyeShadowLayers.some((e=>{var t;return(null===(t=e.product)||void 0===t?void 0:t.metallicIntensity)>0}))&&(n.push("Eyeshadow/metalliceyeshadow_normalmap.png"),n.push("metalliceye_masknormal.png"),n.push("metalliceye_masknormal_rgb.png"),n.push("metalliceye_masknormal_alpha.png"),n.push("metalliceye_mask_delta_uv.png")),e.eyeShadowLayers.some((e=>{var t;return(null===(t=e.product)||void 0===t?void 0:t.vinylIntensity)>0}))&&(n.push("Eyeshadow/cube10.png"),n.push("Eyeshadow/eye_normal.png")),e.eyeShadowLayers.some((e=>{var t;return(null===(t=e.product)||void 0===t?void 0:t.gloss)>0}))&&(i.push("Eyeshadow/Glossy_Lid7.png"),i.push("Eyeshadow/gloss4.png"));const a=n.map((e=>new X(e,!1,!0)));t.push(...a);const s=i.map((e=>new X(e,!0,!0)));t.push(...s)}e.faceOverlayLayers&&(s(e.faceOverlayLayers),e.faceOverlayLayers.forEach((e=>{"alphaBlend"===e.blendMode&&("overlayFilled"===e.presetStyle?t.push(new X("overlay-mask-filled.png",!0,!0)):t.push(new X("overlay-mask.png",!0,!0)))}))),e.concealerLayer&&(r(e.concealerLayer),te(e.concealerLayer)&&o(e.concealerLayer));const u=[];return e.lipLayer&&u.push(e.lipLayer),e.lipLayers&&u.push(...e.lipLayers),u.forEach((e=>{var n;te(e)?o(e):(null===(n=e.product)||void 0===n?void 0:n.envMappingIntensity)>0&&(t.push(new X("map6_normals.png",!1,!0)),void 0!==e.presetStyle&&"brilliant"===e.presetStyle?t.push(new X("cube2.png",!1,!0)):t.push(new X("cube3.png",!1,!0))),r(e,.01)})),e.lipLinerLayer&&te(e.lipLinerLayer)&&(r(e.lipLinerLayer),o(e.lipLinerLayer)),e.foundationLayer&&(a(e.foundationLayer,!1),te(e.foundationLayer)&&o(e.foundationLayer)),e.primerLayer&&(a(e.primerLayer,!1),te(e.primerLayer)&&o(e.primerLayer)),e.settingSprayLayer&&(a(e.settingSprayLayer,!0),te(e.settingSprayLayer)&&o(e.settingSprayLayer)),e.cushionLayer&&(a(e.cushionLayer,!1),te(e.cushionLayer)&&o(e.cushionLayer)),e.deformableFoundationLayers&&s(e.deformableFoundationLayers),e.browLayer&&n(e.browLayer),function(e){const t=[],r=[];return e.forEach((e=>{t.includes(e.resourceURL)||(t.push(e.resourceURL),r.push(e))})),r}(t)}e.RenderQuality=void 0,(I=e.RenderQuality||(e.RenderQuality={}))[I.Medium=0]="Medium",I[I.High=1]="High",e.BlushLayer=E,e.BlushMapping=u,e.BrowColoringParams=P,e.BrowLayer=O,e.BrowOverlayParams=F,e.BrowWarpingParams=C,e.ConcealerLayer=L,e.CoreSDKWrapper=class{constructor(t){this.module=null,this.cameraArraySize=0,this.cameraArrayPtr=0,this.cameraArray=null,this.cameraWidth=0,this.cameraHeight=0,this.loadImageHandler=null,this.loadJSONHandler=null,this.currentLookBefore=null,this.currentLookBeforeJSON=null,this.currentLookAfter=null,this.currentLookAfterJSON=null,this.loadedMasks=new Map,this.loadedJSONs=new Map,this.emscriptenConstructor=null,this.quality=e.RenderQuality.Medium,this.convertOutputToNV12=!1,this.enableComparisonMode=!1,this.comparisonPercent=.5,this.enableFaceChart=!1,this.flipY=!1,this.drawFacePoints=!1,this.emscriptenLocateFileFunc=null,this.requestOverride=null,this.printOverride=null,this.loadLookResourcesInParallel=!1,this.enableParallelTracking=!1,this.instantiateWasmOverride=null,this.emscriptenConstructor=t}load(e,t,r){return J(this,void 0,void 0,(function*(){const n=new Promise((n=>{const i={canvas:e,postRun:()=>{this.log("postRun"),i.cw_init=i.cwrap("init",null,["number","number"]),i.cw_resizeView=i.cwrap("resizeView",null,["number","number"]),i.cw_setFaceTrackerData=i.cwrap("setFaceTrackerData",null,["array","number","number","number","number","number","number","number","number"]),i.cw_getIsMouthOpen=i.cwrap("getIsMouthOpen","number",["number"]),i.cw_resetTrackerData=i.cwrap("resetTrackerData",null,[]),i.cw_setMakeupLookBefore=i.cwrap("setMakeupLookBefore",null,["string"]),i.cw_setMakeupLookAfter=i.cwrap("setMakeupLookAfter",null,["string"]),i.cw_addImageToCache=i.cwrap("addImageToCache",null,["string","number","number","number","number"]),i.cw_addJSONToCache=i.cwrap("addJSONToCache",null,["string","string"]),i.cw_setQuality=i.cwrap("setQuality",null,["number"]),i.cw_render=i.cwrap("render",null,["number","number","number","number"]),i.cw_renderFromNV12Data=i.cwrap("renderFromNV12Data",null,["number"]),i.cw_captureOutput=i.cwrap("captureOutput",null,["number","number","number","number","number"]),i.cw_freeCapturedOutput=i.cwrap("freeCapturedOutput",null,[]),i.cw_setComparisonModeSettings=i.cwrap("setComparisonModeSettings",null,["number","number"]),i.cw_setEnableFaceChart=i.cwrap("setEnableFaceChart",null,["number"]),i.cw_glitterTextureExists=i.cwrap("glitterTextureExists","number",["number","number","number","number"]),i.cw_addGlitterTexture=i.cwrap("addGlitterTexture",null,["number","number","number","number","number","number","number"]),i.cw_getMaxGlitterCacheSize=i.cwrap("getMaxGlitterCacheSize","number",[]),i.cw_setMaxGlitterCacheSize=i.cwrap("setMaxGlitterCacheSize",null,["number"]),i.cw_setConvertOutputToNV12=i.cwrap("setConvertOutputToNV12",null,["number"]),i.cw_getCanvasBufferPixelData=i.cwrap("getCanvasBufferPixelData",null,["number","number","number","number"]),i.cw_setFlipY=i.cwrap("setFlipY",null,["number"]),i.cw_setEnableParallelTracking=i.cwrap("setEnableParallelTracking",null,["number"]),i.cw_useAndConvertNV12Input=i.cwrap("useAndConvertNV12Input","number",["number","number","number","number","number"]),i.cw_init(t,r),n()}};if("undefined"!=typeof XMLHttpRequest)i.request=XMLHttpRequest;else{if(!this.requestOverride)throw new Error("CoreSDKWrapper.requestOverride was not set");i.request=this.requestOverride}this.emscriptenLocateFileFunc&&(i.locateFile=this.emscriptenLocateFileFunc),this.printOverride&&(i.print=this.printOverride,i.printErr=this.printOverride),this.instantiateWasmOverride&&(i.instantiateWasm=this.instantiateWasmOverride),this.module=this.emscriptenConstructor(i)}));yield n,this.currentLookBefore&&this.setLookBefore(this.currentLookBefore,!0),this.currentLookAfter&&this.setLook(this.currentLookAfter,!0),this.setEnableComparisonMode(this.enableComparisonMode),this.setComparisonPercent(this.comparisonPercent),this.setQuality(this.quality),this.setConvertOutputToNV12(this.convertOutputToNV12),this.setEnableParallelTracking(this.enableParallelTracking),this.setFlipY(this.flipY)}))}log(e){this.printOverride?this.printOverride(e):console.log(e)}allocateCameraBuffer(e,t){return J(this,void 0,void 0,(function*(){const r=e*t*4;this.cameraArraySize!==r&&(this.cameraArrayPtr&&this.module._free(this.cameraArrayPtr),this.cameraArraySize=r,this.cameraArrayPtr=this.module._malloc(r),this.cameraArray=new Uint8Array(this.module.HEAPU8.buffer,this.cameraArrayPtr,r),this.cameraWidth=e,this.cameraHeight=t)}))}preloadMask(e){return J(this,void 0,void 0,(function*(){const{resourceURL:t,isGrayscale:r,isBuiltIn:n}=e;if(this.loadedMasks.get(t))return void(this.loadedMasks.get(t).isGrayscale!==r&&console.warn(`${t} is already loaded with different color settings`));this.log(`Loading mask ${t}, grayscale: ${r}`);const{buffer:i,width:a,height:o}=yield this.loadImageHandler(t,r,!1,n),s=r?1:4,u=a*o*s,c=this.module._malloc(u);new Uint8Array(this.module.HEAPU8.buffer,c,u).set(i);const l={storagePointer:c,isGrayscale:r};this.loadedMasks.set(t,l),this.module.cw_addImageToCache(t,c,a,o,s)}))}preloadJSON(e){return J(this,void 0,void 0,(function*(){const{resourceURL:t}=e;if(this.loadedJSONs.get(t))return;this.log(`Loading json ${t}`);const r=yield this.loadJSONHandler(t),n={json:r};this.loadedJSONs.set(t,n),this.module.cw_addJSONToCache(t,r)}))}preloadGlitter(e){return J(this,void 0,void 0,(function*(){if(!this.module.cw_glitterTextureExists(e.spread,e.density,e.size,e.sizeVariation)){const{buffer:t,width:r,height:n}=yield this.loadImageHandler(e.resourceURL,!1,!0,!0),i=r*n*4,a=this.module._malloc(i);new Uint8Array(this.module.HEAPU8.buffer,a,i).set(t),this.module.cw_addGlitterTexture(a,r,n,e.spread,e.density,e.size,e.sizeVariation),this.module._free(a)}}))}preloadFilesForLook(e){return J(this,void 0,void 0,(function*(){const t=ie(e).map((e=>{const t=new Map;return t.set("image",this.preloadMask.bind(this)),t.set("json",this.preloadJSON.bind(this)),t.set("glitter",this.preloadGlitter.bind(this)),{request:e,preloadHandler:t.get(e.loadHandlerType)}}));if(this.loadLookResourcesInParallel){const e=t.map((e=>e.preloadHandler(e.request)));yield Promise.all(e)}else{let e=Promise.resolve();t.forEach((t=>{e=e.then((()=>t.preloadHandler(t.request)))})),yield e}}))}destroy(){this.module&&this.cameraArrayPtr&&this.module._free(this.cameraArrayPtr)}setLoadImageHandler(e){this.loadImageHandler=e}setLoadJSONHandler(e){this.loadJSONHandler=e}setLook(e,t=!1){return J(this,void 0,void 0,(function*(){const r=K(e);(t||this.currentLookAfterJSON!==r)&&(this.currentLookAfter=j(e),this.currentLookAfterJSON=r,yield this.preloadFilesForLook(this.currentLookAfter),this.module&&this.module.cw_setMakeupLookAfter(K(this.currentLookAfter)))}))}getLook(){return j(this.currentLookAfter)}setLookBefore(e,t=!1){return J(this,void 0,void 0,(function*(){const r=K(e);(t||this.currentLookBeforeJSON!==r)&&(this.currentLookBefore=j(e),this.currentLookBeforeJSON=r,yield this.preloadFilesForLook(this.currentLookBefore),this.module&&this.module.cw_setMakeupLookBefore(K(this.currentLookBefore)))}))}getLookBefore(){return j(this.currentLookBefore)}setEnableComparisonMode(e){this.enableComparisonMode=e,this.module&&this.module.cw_setComparisonModeSettings(this.enableComparisonMode,this.comparisonPercent)}getEnableComparisonMode(){return this.enableComparisonMode}setComparisonPercent(e){this.comparisonPercent=e,this.module&&this.module.cw_setComparisonModeSettings(this.enableComparisonMode,this.comparisonPercent)}getComparisonPercent(){return this.comparisonPercent}setEnableFaceChart(e){this.enableFaceChart=e,this.module&&this.module.cw_setEnableFaceChart(e)}getEnableFaceChart(){return this.enableFaceChart}setQuality(e){this.quality=e,this.module&&this.module.cw_setQuality(this.quality)}getQuality(){return this.quality}setConvertOutputToNV12(e){this.convertOutputToNV12=e,this.module&&this.module.cw_setConvertOutputToNV12(e)}getConvertOutputToNV12(){return this.convertOutputToNV12}setEnableParallelTracking(e){this.enableParallelTracking=e,this.module&&this.module.cw_setEnableParallelTracking(e)}getEnableParallelTracking(){return this.enableParallelTracking}setFlipY(e){this.flipY=e,this.module&&this.module.cw_setFlipY(e)}getFlipY(){return this.flipY}setFaceTrackerData(e,t,r,n,i,a,o,s="unset"){const u={imageWidth:t,imageHeight:r,faceData:[{facePts:e,faceboxX:n,faceboxY:i,faceboxWidth:a,faceboxHeight:o,mouthOpenOverride:s}]};this.setMultiFaceTrackerData(u)}setMultiFaceTrackerData(e){if(this.module){if(!(null==e?void 0:e.faceData)||0===e.faceData.length)return void this.resetTrackerData();e.faceData.forEach(((t,n)=>{const i=r.exports.FacePoints.serialize(t.facePts);this.module.cw_setFaceTrackerData(i,i.length,e.imageWidth,e.imageHeight,t.faceboxX,t.faceboxY,t.faceboxWidth,t.faceboxHeight,{unset:0,open:1,closed:2}[t.mouthOpenOverride],n,e.faceData.length)}))}}getIsMouthOpen(e=0){return!!this.module&&this.module.cw_getIsMouthOpen(e)}resetTrackerData(){this.module&&this.module.cw_resetTrackerData()}render(e,t,n){r.exports.assert(t*n*4===e.byteLength),this.module&&(this.allocateCameraBuffer(t,n),this.cameraArray.set(e),this.module.cw_render(t,n,this.cameraArrayPtr,this.drawFacePoints))}renderFromNV12Data(){this.module&&this.module.cw_renderFromNV12Data(this.drawFacePoints)}redraw(){this.module&&this.cameraArrayPtr&&this.module.cw_render(this.cameraWidth,this.cameraHeight,this.cameraArrayPtr,this.drawFacePoints)}resizeView(e,t){r.exports.assert(e>0&&t>0,"New view dimensions cannot be zero"),this.module&&this.module.cw_resizeView(e,t)}captureOutput(e=!1,t=!1){const{module:r}=this;if(!r)return null;const n=r._malloc(4),i=new Uint32Array(r.HEAPU32.buffer,n,1),a=r._malloc(4),o=new Uint32Array(r.HEAPU32.buffer,a,1),s=r._malloc(4),u=new Uint32Array(r.HEAPU32.buffer,s,1);this.module.cw_captureOutput(n,a,s,e?1:0,t?1:0);const c=i[0],l=o[0],h=u[0];let d=null;return c&&(d=new Uint8Array(r.HEAPU8.buffer,c,l*h*4).slice()),r.cw_freeCapturedOutput(),r._free(n),r._free(a),r._free(s),c?{buffer:d,width:l,height:h}:null}getCanvasBufferPixelData(){const{module:e}=this;if(!e)return null;const t=e._malloc(4),r=new Uint32Array(e.HEAPU32.buffer,t,1),n=e._malloc(4),i=new Uint32Array(e.HEAPU32.buffer,n,1),a=e._malloc(4),o=new Uint32Array(e.HEAPU32.buffer,a,1),s=e._malloc(4),u=new Uint32Array(e.HEAPU32.buffer,s,1);this.module.cw_getCanvasBufferPixelData(t,n,a,s);const c=r[0],l=i[0],h=o[0],d=u[0];let f=null;return c&&(f=new Uint8Array(e.HEAPU8.buffer,c,l).slice()),e._free(t),e._free(n),e._free(a),e._free(s),c?{buffer:f,width:h,height:d}:null}getMaxGlitterCacheSize(){return this.module?this.module.cw_getMaxGlitterCacheSize():null}setMaxGlitterCacheSize(e){r.exports.assert(e>0,"Glitter cache size cannot be zero"),this.module&&this.module.cw_setMaxGlitterCacheSize(e)}useAndConvertNV12Input(e,t,r){this.allocateCameraBuffer(e.width,3*e.height/8),this.cameraArray.set(e.buffer);const n=void 0!==t?t:e.width/4,i=void 0!==r?r:e.height/4,a=this.module.cw_useAndConvertNV12Input(e.width,e.height,this.cameraArrayPtr,n,i);return{buffer:new Uint8Array(this.module.HEAPU8.buffer,a,n*i*4),width:n,height:i}}},e.CustomBlushPlacements=c,e.CustomEyelinerPlacements=h,e.CustomEyeshadowPlacements=f,e.CustomLipPlacements=g,e.CustomMascaraPlacements=y,e.DeformableCustomLayer=R,e.DeformableFoundationLayer=class extends w{constructor(e,t,r,n,i,a,o,s,u,c,l,h,d,f,p){super(e,t,r),this.referenceLeftEyePoints=n,this.referenceLeftBrowPoints=i,this.referenceRightEyePoints=a,this.referenceRightBrowPoints=o,this.referenceOuterMouthPoints=s,this.referenceInnerMouthPoints=u,this.referenceFacePoints=c,this.referenceForeheadPoints=l,this.referenceNosePoints=h,this.referenceCheekPoints=d,this.referenceLeftExtendedBrowPoints=f,this.referenceRightExtendedBrowPoints=p,this.referenceIsMouthOpen=!1,this.referenceIsContourUsed=!1,this.deformationAreaFactor=1,this.eraseExpandFactorTop=1,this.eraseExpandFactorHorizontal=1,this.eraseBlurFactor=1,this.topLeftEyeWeight=1,this.bottomLeftEyeWeight=1,this.topRightEyeWeight=1,this.bottomRightEyeWeight=1,this.topLeftBrowWeight=.01,this.bottomLeftBrowWeight=.01,this.topRightBrowWeight=.01,this.bottomRightBrowWeight=.01,this.topOuterLipWeight=1,this.bottomOuterLipWeight=1,this.topInnerLipWeight=1,this.bottomInnerLipWeight=1,this.leftNoseWeight=1,this.middleNoseWeight=1,this.rightNoseWeight=1,this.leftFaceWeight=.01,this.chinWeight=.01,this.rightFaceWeight=.01,this.rightTempleWeight=.01,this.foreheadWeight=.01,this.leftTempleWeight=.01}},e.EraseDeformableCustomLayer=M,e.EyeLinerLayer=b,e.EyelinerMapping=l,e.EyeshadowLayer=D,e.EyeshadowMapping=d,e.FaceOverlayLayer=class extends w{constructor(e,t="overlay"){const r={overlay:"overlay-mask.png",overlayFilled:"overlay-mask-filled.png"};let n=e;n||(n=r[t]?r[t]:r.overlay),super(new i,n,{width:256,height:256}),this.presetStyle=t,this.blendMode="alphaBlend"}},e.FacePoints=r.exports.FacePoints,e.FoundationLayer=T,e.LipcolorMapping=m,e.LipstickLayer=_,e.Look=n,e.MakeupLayer=k,e.MakeupMaskLayer=w,e.MascaraLayer=x,e.MascaraMapping=v,e.PixelData=r.exports.PixelData,e.Point=r.exports.Point,e.Product=i,e.Timer=r.exports.Timer,e.assert=r.exports.assert,e.convertFromLookGeneratorToLite=function(e,t=null,r=null){const i=new n;if(e){Object.assign(i,{lipLayer:$(e.lipLayer,"default","MakeupLipLayer"),lipLayers:q(e.lipLayers,"default","MakeupLipLayer"),blushLayers:q(e.blushLayers,"blush","MakeupBlushLayer"),eyeLinerLayers:q(e.eyeLinerLayers,"natural","MakeupEyeLinerLayer"),mascaraLayers:q(e.mascaraLayers,"natural","MakeupMascaraLayer"),eyeShadowLayers:q(e.eyeShadowLayers,"lid","MakeupEyeShadowLayer"),foundationLayer:$(e.foundationLayer),cushionLayer:$(e.cushionLayer),primerLayer:$(e.primerLayer),settingSprayLayer:$(e.settingSprayLayer),lipLinerLayer:$(e.lipLinerLayer),concealerLayer:$(e.concealerLayer,"default","MakeupConcealerLayer"),deformableFoundationLayers:q(e.deformableFoundationLayers,"custom","MakeupDeformableFoundationLayer"),browLayer:Y(e.browEffectsLayer)});const t=function(e){const t=["eyeEraseExpandFactorInner","eyeEraseExpandFactorOuter","eyeEraseExpandFactorTop","eyeEraseExpandFactorBottom"].filter((t=>N(e[t])));return t.length>0?(console.warn('Warning: eye erase parameters have been consolidated into "eyeEraseExpandFactor", will use the average'),t.reduce(((t,r)=>t+e[r]),0)/t.length):null}(e);"number"==typeof t&&(i.eyeEraseExpandFactor=t),i.shouldApplySkinEffectsToBaseLook=Boolean(e.shouldApplySkinEffectsToBaseLook),z(e,"intensity",i,"intensity"),z(e,"skinClearingAmount",i,"skinSmoothing"),z(e,"skinGlowAmount",i,"skinGlow"),z(e,"skinBrighteningAmount",i,"skinBrightening")}return function(e,t){if(!t)return;const r=(r,n)=>{z(t,r,e,n)};r("nostrilWarpHoriz","nostrilThinning"),r("noseBridgeWarpHoriz","noseBridgeThinning"),r("jawLine","jawSlimming"),r("eyeEnlargeVert","eyeHeightEnlarge"),r("eyeEnlargeHoriz","eyeWidthEnlarge"),r("lipVolume","lipVolume"),r("skinClearingAmount","skinSmoothing"),r("skinBrighteningAmount","skinBrightening"),r("skinGlowAmount","skinGlow")}(i,t),r&&(z(r,"skinClearingAmount",i,"skinSmoothing","max"),z(r,"skinGlowAmount",i,"skinGlow","max"),z(r,"skinBrighteningAmount",i,"skinBrightening","max")),i},e.serializeLookJSON=K,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,B.exports);var N=m(B.exports),z=s((function e(t,r,n){a(this,e),this.detectionResult=t,this.imageData=r,this.canvas=n,this.imageDataCopy=null})),H={exports:{}};!function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,r,n;try{t=Map}catch(e){t=function(){}}try{r=Set}catch(e){r=function(){}}try{n=Promise}catch(e){n=function(){}}function i(a,s,u,c,l){"object"==typeof s&&(u=s.depth,c=s.prototype,l=s.includeNonEnumerable,s=s.circular);var h=[],d=[],f="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===u&&(u=1/0),function a(u,p){if(null===u)return null;if(0===p)return u;var m,g;if("object"!=typeof u)return u;if(e(u,t))m=new t;else if(e(u,r))m=new r;else if(e(u,n))m=new n((function(e,t){u.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(u))m=[];else if(i.__isRegExp(u))m=new RegExp(u.source,o(u)),u.lastIndex&&(m.lastIndex=u.lastIndex);else if(i.__isDate(u))m=new Date(u.getTime());else{if(f&&Buffer.isBuffer(u))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(m),m;e(u,Error)?m=Object.create(u):void 0===c?(g=Object.getPrototypeOf(u),m=Object.create(g)):(m=Object.create(c),g=c)}if(s){var v=h.indexOf(u);if(-1!=v)return d[v];h.push(u),d.push(m)}for(var y in e(u,t)&&u.forEach((function(e,t){var r=a(t,p-1),n=a(e,p-1);m.set(r,n)})),e(u,r)&&u.forEach((function(e){var t=a(e,p-1);m.add(t)})),u){var k;g&&(k=Object.getOwnPropertyDescriptor(g,y)),k&&null==k.set||(m[y]=a(u[y],p-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(u);for(y=0;y<w.length;y++){var _=w[y];(!(x=Object.getOwnPropertyDescriptor(u,_))||x.enumerable||l)&&(m[_]=a(u[_],p-1),x.enumerable||Object.defineProperty(m,_,{enumerable:!1}))}}if(l){var b=Object.getOwnPropertyNames(u);for(y=0;y<b.length;y++){var x,D=b[y];(x=Object.getOwnPropertyDescriptor(u,D))&&x.enumerable||(m[D]=a(u[D],p-1),Object.defineProperty(m,D,{enumerable:!1}))}}return m}(a,u)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=t)}(H);var W=H.exports;function V(e,t,r){void 0!==e[t]&&(e[r]=e[t],delete e[t])}function U(e){return"number"==typeof e}function G(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"overwrite",a=e[t];U(a)&&(r[n]&&"max"===i?r[n]=Math.max(r[n],a):r[n]=a)}function Y(e,t){if(!e)return t;var r,n="Style",i=e.indexOf(n);if(-1===i)return r="presetStyle '".concat(e,"' cannot be converted"),console.error(r),t;var a=e.substring(i+n.length);return a.charAt(0).toLowerCase()+a.slice(1)}function $(e,t,r){return t&&t in e?e[t]:r}function q(e){return $({MFEMakeupLayerBlendModeMakeup:"makeup",MFEMakeupLayerBlendModeAlphaBlend:"alphaBlend",MFEMakeupLayerBlendModeMakeupBlend:"makeupBlend",MFEMakeupLayerBlendModeSolidColorBlend:"solidColorBlend"},e,"makeup")}function K(e,t){return e&&e.includes("|")?"both":$({MFEMakeupLayerSideNone:"none",MFEMakeupLayerSideLeft:"left",MFEMakeupLayerSideRight:"right",MFEMakeupLayerSideBoth:"both"},e,t)}function J(e){return $({MFEMakeupLipstickPlacementFull:"full",MFEMakeupLipstickPlacementInnerHorizontal:"innerHorizontal",MFEMakeupLipstickPlacementOuterHorizontal:"outerHorizontal",MFEMakeupLipstickPlacementInnerVertical:"innerVertical",MFEMakeupLipstickPlacementOuterVertical:"outerVertical"},e,"full")}function Q(e){if(!e)return null;var t=new B.exports.Product;return Object.assign(t,e),V(t,"colorR","r"),V(t,"colorG","g"),V(t,"colorB","b"),V(t,"colorA","a"),V(t,"intensity","amount"),V(t,"sparkleIntensity","glitter"),V(t,"sparkleDensity","glitterDensity"),V(t,"sparkleR","glitterColorR"),V(t,"sparkleG","glitterColorG"),V(t,"sparkleB","glitterColorB"),V(t,"sparkleSize","glitterSize"),V(t,"sparkleBaseReflectivity","glitterBaseReflectivity"),V(t,"sparkleColorVariation","glitterColorVariation"),V(t,"sparkleSizeVariation","glitterSizeVariation"),t}function X(e){if(!e)return null;var t=new B.exports.BrowOverlayParams;return Object.assign(t,e),t.side=$({Left:"left",Right:"right"},t.side,"left"),t}function Z(e){e&&e.params&&(Object.assign(e,e.params),delete e.params,e.coloringParams=function(e){if(!e)return null;var t=new B.exports.BrowColoringParams;return Object.assign(t,e),t.colorA&&(t.colorAmount=t.colorA/255),t}(e.coloringParams),e.overlayParams=X(e.overlayParams),e.fillOverlayParams=X(e.fillOverlayParams))}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"custom";e&&(e.presetStyle=Y(e.presetStyle,t),e.blendMode=q(e.blendMode),e.sourceSide=K(e.sourceSide,"left"),e.targetSide=K(e.targetSide,"both"),e.product=Q(e.product),V(e,"maskJsonPath","maskJSONPath"),e.eraseMasks&&e.eraseMasks.forEach((function(e){V(e,"maskJsonPath","maskJSONPath")})),"MakeupLipLayer"===e.class&&(e.placement=J(e.placement)),e.shadeMatchedProduct&&(e.shadeMatchedProduct=Q(e.shadeMatchedProduct)))}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"custom";e&&e.forEach((function(e){return ee(e,t)}))}function re(e){var t=["eyeEraseExpandFactorInner","eyeEraseExpandFactorOuter","eyeEraseExpandFactorTop","eyeEraseExpandFactorBottom"].filter((function(t){return U(e[t])}));if(t.length>0){O('Warning: eye erase parameters have been consolidated into "eyeEraseExpandFactor", will use the average');var r=t.reduce((function(t,r){return t+e[r]}),0)/t.length;e.eyeEraseExpandFactor=r}}function ne(e,t){if(t){var r=function(r,n){G(t,r,e,n)};r("nostrilWarpHoriz","nostrilThinning"),r("noseBridgeWarpHoriz","noseBridgeThinning"),r("jawLine","jawSlimming"),r("eyeEnlargeVert","eyeHeightEnlarge"),r("eyeEnlargeHoriz","eyeWidthEnlarge"),r("lipVolume","lipVolume"),r("skinClearingAmount","skinSmoothing"),r("skinBrighteningAmount","skinBrightening"),r("skinGlowAmount","skinGlow")}}function ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e?W(e):{};return ee(n.lipLayer,"default"),te(n.lipLayers,"default"),te(n.blushLayers,"blush"),te(n.eyeLinerLayers,"natural"),te(n.mascaraLayers,"natural"),te(n.eyeShadowLayers,"lid"),ee(n.foundationLayer),ee(n.cushionLayer),ee(n.primerLayer),ee(n.settingSprayLayer),ee(n.lipLinerLayer),ee(n.concealerLayer,"default"),te(n.deformableFoundationLayers),V(n,"browEffectsLayer","browLayer"),Z(n.browLayer),re(n),V(n,"skinClearingAmount","skinSmoothing"),V(n,"skinGlowAmount","skinGlow"),V(n,"skinBrighteningAmount","skinBrightening"),ne(n,t),r&&(G(r,"skinClearingAmount",n,"skinSmoothing","max"),G(r,"skinGlowAmount",n,"skinGlow","max"),G(r,"skinBrighteningAmount",n,"skinBrightening","max")),n}var ae=function(){function e(t){a(this,e),t||I("need the coreSDK to create MakeupEffects"),this.creationInProgress=!1,this.coreSDK=t,this.makeupLooks={}}var t;return s(e,[{key:"hasLook",value:function(e){return Boolean(this.makeupLooks[e])}},{key:"getLook",value:function(e){return this.makeupLooks[e]}},{key:"removeLook",value:function(e){this.makeupLooks[e]&&delete this.makeupLooks[e]}},{key:"createLook",value:(t=i(k.mark((function e(t,r,n,i){var a,o=this;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.creationInProgress){e.next=2;break}throw new Error("Refusing to create MakeupProcedures as another call is in progress");case 2:return this.creationInProgress=!0,a=ie(t,n),e.abrupt("return",this.coreSDK.preloadFilesForLook(a).then((function(){return o.makeupLooks[r]={},o.makeupLooks[r].lookGeneratorLook=t,o.makeupLooks[r].faceEffects=n,o.makeupLooks[r].enableFaceChart=i,o.creationInProgress=!1,!0}),(function(e){o.creationInProgress=!1,I(e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,r,n,i){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;Object.keys(this.makeupLooks).forEach((function(t){delete e.makeupLooks[t]})),this.makeupLooks={},this.coreSDK=null}}]),e}(),oe=function(){function e(t){a(this,e),this.originalCanvas=null,this.hasRendered=!1,this.lookManager=null,this.mediaData=null,this.shouldKeepOriginal=!0,this.smoothDegree=0,this.coreSDK=null,this.outputCanvas=null,this.currentImageData=null,this.resourceResolver=t,this.currentLookId=null,this.currentBaseLook=null,this.mouthOverrideState="unset"}var t,r,n,o,u;return s(e,[{key:"width",get:function(){return this.originalCanvas.width}},{key:"height",get:function(){return this.originalCanvas.height}},{key:"init",value:(u=i(k.mark((function e(t,r){var n,a,o,s=this;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.originalCanvas||(this.originalCanvas=j(t,r)),this.outputCanvas=document.createElement("canvas"),this.outputCanvas.width=t,this.outputCanvas.height=r,n=function(){var e=i(k.mark((function e(t,r,n,i){var a,o,u,c,l,h,d,f,p,m,g,v;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.resourceResolver.resolveImageLocation(t,n,i),mfBroadcast(w.EventStage.RESOURCE,a),e.next=4,new Promise((function(e,t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(e){return t(e)},r.src=a}));case 4:if(o=e.sent,(u=document.createElement("canvas")).width=o.naturalWidth,u.height=o.naturalHeight,(c=u.getContext("2d")).drawImage(o,0,0),l=c.getImageData(0,0,u.width,u.height),h=new Uint8Array(l.data),d=o.naturalWidth*o.naturalHeight,r){for(f=new Uint8Array(d),p=0;p<f.length;p+=1)f[p]=h[4*p];h=f}else if(!n)for(m=0;m<d;m+=1)g=h[4*m+3]/255,h[4*m]=h[4*m]*g,h[4*m+1]=h[4*m+1]*g,h[4*m+2]=h[4*m+2]*g;return v={buffer:h,width:l.width,height:l.height},e.abrupt("return",v);case 16:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),a=function(){var e=i(k.mark((function e(t){var r,n,i;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.resourceResolver.resolveJsonLocation(t),mfBroadcast(w.EventStage.RESOURCE,r),e.next=4,fetch(r);case 4:return n=e.sent,e.next=7,n.text();case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=8,MF_MODULE_LOADER.wasmModulePromises.coreSDKWasmModule;case 8:return o=e.sent,this.coreSDK=new N.CoreSDKWrapper(CoreSDK),this.coreSDK.setLoadImageHandler(n),this.coreSDK.setLoadJSONHandler(a),this.coreSDK.setQuality(N.RenderQuality.High),this.coreSDK.loadLookResourcesInParallel=!0,this.coreSDK.instantiateWasmOverride=function(e,t){return WebAssembly.instantiate(o,e).then((function(e){t(e)})),{}},e.next=17,this.coreSDK.load(this.outputCanvas,t,r);case 17:this.lookManager=new ae(this.coreSDK),t===this.width&&r===this.height||this.coreSDK.resizeView(t,r),this.setSmoothingIntensity(this.smoothDegree);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"getBeforeEffectsCanvas",value:function(){return this.originalCanvas}},{key:"getOutputCanvas",value:function(){return this.outputCanvas}},{key:"setMouthOpen",value:function(e){this.mouthOverrideState=e?"open":"closed",this.mediaData&&this.setMediaData(this.mediaData)}},{key:"unsetMouthOpen",value:function(){this.mouthOverrideState="unset",this.mediaData&&this.setMediaData(this.mediaData)}},{key:"isMouthOpen",value:function(){var e,t;return null!==(e=null===(t=this.coreSDK)||void 0===t?void 0:t.getIsMouthOpen())&&void 0!==e&&e}},{key:"resize",value:function(e,t){var r;("number"!=typeof e||"number"!=typeof t||e<0||t<0)&&I("Invalid arguments to resize"),this.originalCanvas.width=e,this.originalCanvas.height=t,this.outputCanvas.width=e,this.outputCanvas.height=t,null===(r=this.coreSDK)||void 0===r||r.resizeView(e,t)}},{key:"setShouldKeepOriginal",value:function(e){this.shouldKeepOriginal=e}},{key:"setMediaData",value:function(t){var r,n,i=this;if(t instanceof z||I("Type error"),this.mediaData=t,t.canvas.width!==this.outputCanvas.width||t.canvas.height!==this.outputCanvas.height){var a=t.canvas.width,o=t.canvas.height;this.resize(a,o)}this.shouldKeepOriginal&&this.originalCanvas.getContext("2d").drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height);var s=t.imageData;if((null===(r=t.detectionResult)||void 0===r||null===(n=r.faces)||void 0===n?void 0:n.length)>0){var u=[];t.detectionResult.faces.forEach((function(t,r){var n=e.reformatFacePoints(t.facePoints);u.push({facePts:n,faceboxX:t.facebox.x,faceboxY:t.facebox.y,faceboxWidth:t.facebox.width,faceboxHeight:t.facebox.height,mouthOpenOverride:0===r?i.mouthOverrideState:"unset"})}));var c={imageWidth:t.imageData.width,imageHeight:t.imageData.height,faceData:u};this.coreSDK.setMultiFaceTrackerData(c)}else this.coreSDK.resetTrackerData();this.currentImageData=s.data}},{key:"hasLook",value:function(e){return this.lookManager.hasLook(e)}},{key:"removeLook",value:function(e){this.lookManager.removeLook(e)}},{key:"setBaseLook",value:(o=i(k.mark((function e(t){var r;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentBaseLook=t,r=ie(t),e.next=4,this.coreSDK.setLookBefore(r);case 4:return e.next=6,this.updateRendererLook();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setLook",value:(n=i(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lookManager.hasLook(t)||I("Cannot use a lookId ".concat(t," that does not exist")),this.currentLookId=t,e.next=4,this.updateRendererLook();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateRendererLook",value:(r=i(k.mark((function e(){var t,r,n,i,a,o;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.currentLookId,r=t?this.lookManager.getLook(t):null,n=r?r.lookGeneratorLook:null,i=r?r.faceEffects:null,a=ie(n,i,this.currentBaseLook),e.next=7,this.coreSDK.setLook(a);case 7:o=!!r&&r.enableFaceChart,this.coreSDK.setEnableFaceChart(o);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"render",value:function(){this.coreSDK.render(this.currentImageData,this.width,this.height),this.hasRendered=!0}},{key:"destroy",value:function(){this.lookManager.destroy(),this.coreSDK.destroy(),this.coreSDK=null}},{key:"createLook",value:(t=i(k.mark((function e(t,r,n,i){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lookManager||I("need the procedureManager to createEffects"),e.abrupt("return",this.lookManager.createLook(t||{},r,n,i));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r,n,i){return t.apply(this,arguments)})},{key:"setShouldShowPoints",value:function(e){this.coreSDK.drawFacePoints=e}},{key:"setSmoothingIntensity",value:function(e){var t={skinClearingAmount:e,shouldApplySkinEffectsToBaseLook:!0};this.setBaseLook(t)}},{key:"playTutorial",value:function(e,t){throw new Error("Unimplemented")}},{key:"pauseTutorial",value:function(){throw new Error("Unimplemented")}},{key:"resumeTutorial",value:function(){throw new Error("Unimplemented")}},{key:"stopTutorial",value:function(){throw new Error("Unimplemented")}},{key:"getTutorialStep",value:function(){throw new Error("Unimplemented")}},{key:"setTutorialStep",value:function(e){throw new Error("Unimplemented")}},{key:"setPlayCount",value:function(e){throw new Error("Unimplemented")}},{key:"resetTrackerData",value:function(){this.coreSDK.resetTrackerData()}}],[{key:"reformatFacePoints",value:function(e){var t={x:(e.contour2D[9].x+e.contour2D[10].x)/2,y:(e.contour2D[9].y+e.contour2D[10].y)/2},r=function(e){return[e.x,e.y,e.z]};return{outerMouth:e.extendedOuterMouth2D,innerMouth:e.innerMouth2D,leftEye:e.leftExtendedEye2D,rightEye:e.rightExtendedEye2D,leftBrow:e.leftFullBrow2D,rightBrow:e.rightFullBrow2D,nose:e.extendedNose2D,contour:[e.contour2D[0],t,e.contour2D[19]],foreheadPt:e.forehead2D[1],faceRotation:[e.faceRotation.x,-e.faceRotation.y,-e.faceRotation.z],faceTranslation:r(e.faceTranslation),modelViewProjectionMatrix:e.modelViewProjectionMatrix,modelMatrix:e.modelMatrix,projectionViewMatrix:e.projectionViewMatrix,rightEye3D:r(e.rightEyeCenter3D),leftEye3D:r(e.leftEyeCenter3D),nose3D:r(e.noseCenter3D),mouth3D:r(e.mouthCenter3D),rightEyeInnerCorner3D:r(e.rightEyeInnerCorner3D),leftEyeInnerCorner3D:r(e.leftEyeInnerCorner3D),rightEyeOuterCorner3D:r(e.rightEyeOuterCorner3D),leftEyeOuterCorner3D:r(e.leftEyeOuterCorner3D),rightNose3D:r(e.rightNose3D),leftNose3D:r(e.leftNose3D)}}}]),e}(),se=function(){function e(){a(this,e),this.sourceCanvas=null,this.outputCanvases={}}return s(e,[{key:"getNumDisplays",value:function(){return Object.keys(this.outputCanvases).length}},{key:"toDataURL",value:function(){return this.sourceCanvas.toDataURL()}},{key:"setSource",value:function(e){e instanceof HTMLCanvasElement||I("setSource called with something that is not a canvas element"),this.sourceCanvas=e}},{key:"destroy",value:function(){}},{key:"update",value:function(e){this.sourceCanvas instanceof HTMLCanvasElement||I("Need a source canvas");var t=this.outputCanvases[e];t||I("Attempted to update a canvId that does not exist"),this.sourceCanvas.width===t.width&&this.sourceCanvas.height===t.height||(t.width=this.sourceCanvas.width,t.height=this.sourceCanvas.height),e!==this.sourceCanvas.id&&t.getContext("2d").drawImage(this.sourceCanvas,0,0,t.width,t.height)}},{key:"updateAll",value:function(){var e=this;Object.keys(this.outputCanvases).forEach((function(t){e.update(t)}))}},{key:"display",value:function(e,t,r){var n=this.outputCanvases[t]||this.createCanvas(t);document.getElementById(e).appendChild(n),n.setAttribute("id",t),void 0!==r&&n.setAttribute("class",r),this.outputCanvases[t]=n}},{key:"displaySource",value:function(e,t,r){var n=this.sourceCanvas;document.getElementById(e).appendChild(n),n.setAttribute("id",t),void 0!==r&&n.setAttribute("class",r),this.outputCanvases[t]=n}},{key:"displaySDK",value:function(e){var t=this.outputCanvases[e];return t||(this.createCanvas(e),t=this.outputCanvases[e]),this.update(e),t.setAttribute("id",e),t}},{key:"displaySourceSDK",value:function(e){var t=this.outputCanvases[e],r=t;return t||(r=j(this.sourceCanvas.width,this.sourceCanvas.height)).getContext("2d").drawImage(this.sourceCanvas,0,0,this.sourceCanvas.width,this.sourceCanvas.height),r.setAttribute("id",e),this.outputCanvases[e]=r,r}},{key:"outputCanvasExisted",value:function(e){return!!(this.outputCanvases[e]&&this.outputCanvases[e]instanceof HTMLCanvasElement)}},{key:"createCanvas",value:function(e){var t,r;if(this.sourceCanvas){var n=this.sourceCanvas;t=n.width,r=n.height}else t=100,r=100;this.outputCanvases[e]=j(t,r)}},{key:"undisplay",value:function(e){this.outputCanvases[e]&&this.outputCanvases[e]instanceof HTMLCanvasElement&&this.outputCanvases[e].remove(),delete this.outputCanvases[e]}}]),e}(),ue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a(this,e),this.name=t,this.times=[],this.currentStart=null,this.maxWindowSize=25}return s(e,[{key:"begin",value:function(){this.currentStart=performance.now()}},{key:"end",value:function(){if(this.currentStart){var e=performance.now()-this.currentStart;this.times.push(e),this.times.length>this.maxWindowSize&&this.times.shift(),this.currentStart=null}}},{key:"getAverageTime",value:function(){return 0===this.times.length?0:this.times.reduce((function(e,t){return e+t}))/this.times.length}},{key:"getAverageFPS",value:function(){var e=this.getAverageTime();return e>0?1e3/e:0}}]),e}(),ce=function(){function e(){a(this,e),this.makeupRenderer=null,this.maxFaces=1,this.beforeEffectsDisplayer=null,this.afterEffectsDisplayer=null,this.lookIdToCanvasIds={},this.canvasIdToLookId={},this.singleDefaultId="SINGLE_DEFAULT",this.mediaData=null,this.mode=null,this.targetWidth=null,this.targetHeight=null,this.trueWidth=null,this.trueHeight=null,this.hasValidFace=!1,this.eventQueue={},this.eventToListeners={},this.detectFaceMasks=!1,this.performanceData={reset:function(){this.renderTime=new ue,this.frameToFrameTime=new ue},getAverages:function(){return{avgRenderTime:this.renderTime.getAverageTime(),avgFrameToFrameTime:this.frameToFrameTime.getAverageTime()}}},this.performanceData.reset()}var t,r,n,o,u,c,l,h;return s(e,[{key:"fireEventListener",value:function(e,t){this.eventToListeners[e]&&this.eventToListeners[e].forEach((function(e){return e(t)}))}},{key:"addEventListener",value:function(e,t){this.eventToListeners[e]||(this.eventToListeners[e]=new Set),this.eventToListeners[e].add(t)}},{key:"removeEventListener",value:function(e,t){this.eventToListeners[e]&&this.eventToListeners[e].delete(t)}},{key:"create",value:function(e){var t=e.resourceResolver,r=void 0===t?null:t;this.makeupRenderer&&I("Create was called before already. Re-creation is not supported."),r||I("An instance of MakeupResourceResolver must be passed into create(params) for params.resourceResolver");var n=[];return this.makeupRenderer=new oe(r),n.push(this.makeupRenderer.init(1,1)),this.afterEffectsDisplayer=new se,this.beforeEffectsDisplayer=new se,Promise.all(n)}},{key:"getSourceWidth",value:function(){return this.getMediaSource().getWidth()}},{key:"getSourceHeight",value:function(){return this.getMediaSource().getHeight()}},{key:"destroy",value:function(){this.makeupRenderer.destroy(),this.eventToListeners={},this.makeupRenderer=null}},{key:"show",value:(h=i(k.mark((function e(t){var r,n,i,a,o,s,u;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.view,n=t.canvId,i=t.canvClass,a=t.lookId,o=void 0===a?this.singleDefaultId:a,s=t.updateCanvas,u=void 0!==s&&s,n||I("Need a proper canvasId"),this.lookIdToCanvasIds[o]||(this.lookIdToCanvasIds[o]=[]),this.lookIdToCanvasIds[o].includes(n)||this.lookIdToCanvasIds[o].push(n),this.canvasIdToLookId[n]=o,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.createCanvas(n),e.t0=u,e.t0){e.next=15;break}if(e.t1="photo"===this.mode,!e.t1){e.next=14;break}return e.next=13,this.updateLook(o);case 13:e.t1=e.sent;case 14:e.t0=e.t1;case 15:if(!e.t0){e.next=17;break}this.afterEffectsDisplayer.update(n);case 17:this.afterEffectsDisplayer.display(r,n,i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"showSDK",value:(l=i(k.mark((function e(t){var r,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:this.singleDefaultId,t||I("Need a proper canvasId"),this.lookIdToCanvasIds[r]||(this.lookIdToCanvasIds[r]=[]),this.lookIdToCanvasIds[r].includes(t)||this.lookIdToCanvasIds[r].push(t),this.canvasIdToLookId[t]=r,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.outputCanvasExisted(t)||this.afterEffectsDisplayer.createCanvas(t),e.next=9,this.updateLook(r);case 9:if(!e.sent){e.next=11;break}this.afterEffectsDisplayer.update(t);case 11:return e.abrupt("return",this.afterEffectsDisplayer.displaySDK(t));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"hide",value:function(e){var t=this.canvasIdToLookId[e];t||I("The canvas that you are trying to hide was never created through show.");for(var r=this.lookIdToCanvasIds[t],n=0;n<r.length;n+=1)if(e===r[n]){r.splice(n,1);break}delete this.canvasIdToLookId[e],this.afterEffectsDisplayer.undisplay(e)}},{key:"showRendererCanvas",value:function(e){var t=e.view,r=e.canvId,n=e.canvClass,i=e.lookId,a=void 0===i?this.singleDefaultId:i;r||I("Need a proper canvasId"),this.lookIdToCanvasIds[a]||(this.lookIdToCanvasIds[a]=[]),this.lookIdToCanvasIds[a].includes(r)||this.lookIdToCanvasIds[a].push(r),this.canvasIdToLookId[r]=a,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.displaySource(t,r,n)}},{key:"showRendererCanvasSDK",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.singleDefaultId;return e||I("Need a proper canvasId"),this.lookIdToCanvasIds[t]||(this.lookIdToCanvasIds[t]=[]),this.lookIdToCanvasIds[t].includes(e)||this.lookIdToCanvasIds[t].push(e),this.canvasIdToLookId[e]=t,this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.afterEffectsDisplayer.displaySourceSDK(e)}},{key:"showOriginal",value:function(e){var t=e.view,r=e.canvId,n=e.canvClass;this.beforeEffectsDisplayer.createCanvas(r),this.beforeEffectsDisplayer.display(t,r,n),"photo"===this.mode&&this.beforeEffectsDisplayer.updateAll()}},{key:"showOriginalSource",value:function(e){var t=e.view,r=e.canvId,n=e.canvClass;this.beforeEffectsDisplayer.displaySource(t,r,n)}},{key:"showOriginalSDK",value:function(e){return this.beforeEffectsDisplayer.displaySDK(e)}},{key:"showOriginalSourceSDK",value:function(e){return this.beforeEffectsDisplayer.displaySourceSDK(e)}},{key:"hideOriginal",value:function(e){this.beforeEffectsDisplayer.undisplay(e),this.beforeEffectsDisplayer.getNumDisplays()<=0&&this.makeupRenderer.setShouldKeepOriginal(!1)}},{key:"createLook",value:(c=i(k.mark((function e(t){var r,n,i,a,o,s=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:this.singleDefaultId,n=s.length>2?s[2]:void 0,i=s.length>3?s[3]:void 0,e.next=5,this.makeupRenderer.createLook(t,r,n,i);case 5:if(this.lookIdToCanvasIds[r]||(this.lookIdToCanvasIds[r]=[]),e.t0="photo"===this.mode,!e.t0){e.next=11;break}return e.next=10,this.updateLook(r);case 10:e.t0=e.sent;case 11:if(!e.t0){e.next=14;break}for(a=this.lookIdToCanvasIds[r],o=0;o<a.length;o+=1)this.afterEffectsDisplayer.update(a[o]);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setBaseLook",value:(u=i(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeupRenderer.setBaseLook(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setSmoothingIntensity",value:function(e){this.makeupRenderer.setSmoothingIntensity(e)}},{key:"setShowDebugPoints",value:function(e){this.makeupRenderer.setShouldShowPoints(e)}},{key:"getDetectionResult",value:function(){I("Override please.")}},{key:"isMouthOpen",value:function(){return this.makeupRenderer.isMouthOpen()}},{key:"setMouthOpen",value:function(e){if("boolean"!=typeof e)throw new TypeError;this.makeupRenderer.setMouthOpen(e)}},{key:"unsetMouthOpen",value:function(){this.makeupRenderer.unsetMouthOpen()}},{key:"setMaxFaces",value:function(e){this.maxFaces=e}},{key:"getMaxFaces",value:function(){return this.maxFaces}},{key:"removeMakeupLook",value:function(e){this.makeupRenderer.removeLook(e)}},{key:"captureAfter",value:(o=i(k.mark((function e(){var t,r,n=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:this.singleDefaultId,r=n.length>1&&void 0!==n[1]?n[1]:"png",!this.makeupRenderer.hasLook(t)){e.next=5;break}return e.next=5,this.makeupRenderer.setLook(t);case 5:return this.makeupRenderer.setMediaData(this.makeupRenderer.mediaData,!1),this.makeupRenderer.render(),e.abrupt("return",this.makeupRenderer.getOutputCanvas().toDataURL("image/".concat(r)));case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"captureBefore",value:(n=i(k.mark((function e(){var t,r=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"png",e.abrupt("return",this.beforeEffectsCanvas.toDataURL("image/".concat(t)));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMediaSource",value:function(){I("Override please.")}},{key:"getSource",value:function(){return this.getMediaSource().getSource()}},{key:"setDetectFaceMasks",value:function(e){this.detectFaceMasks=e}},{key:"render",value:(r=i(k.mark((function e(t){var r,n=this;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(this.fireEventListener("frame_rendered"),I("mediaData that was passed to render is invalid.")),this.performanceData.frameToFrameTime.end(),this.performanceData.frameToFrameTime.begin(),this.performanceData.renderTime.begin(),mfBroadcast(w.EventStage.RENDER_START),this.beforeEffectsCanvas=t.canvas,this.makeupRenderer.setMediaData(t),this.afterEffectsDisplayer.setSource(this.makeupRenderer.getOutputCanvas()),this.beforeEffectsDisplayer.setSource(this.beforeEffectsCanvas),r=Promise.resolve(),Object.keys(this.lookIdToCanvasIds).forEach((function(e){r=r.then(i(k.mark((function t(){var r,i;return k.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((r=n.lookIdToCanvasIds[e]).length>0)){t.next=4;break}return t.next=4,n.updateLook(e);case 4:for(i=0;i<r.length;i+=1)n.afterEffectsDisplayer.update(r[i]);case 5:case"end":return t.stop()}}),t)}))))})),e.next=13,r;case 13:this.beforeEffectsDisplayer.updateAll(),this.performanceData.renderTime.end(),mfBroadcast(w.EventStage.RENDER_END),this.fireEventListener("frame_rendered",t.detectionResult);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateLook",value:(t=i(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.makeupRenderer.mediaData){e.next=6;break}if(!this.makeupRenderer.hasLook(t)){e.next=4;break}return e.next=4,this.makeupRenderer.setLook(t);case 4:return this.makeupRenderer.render(),e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),le={exports:{}};le.exports=function(){var e={VERSION:"0.8.0",not:{},all:{},any:{}},t=Object.prototype.toString,r=Array.prototype.slice,n=Object.prototype.hasOwnProperty;function i(e){return function(){return!e.apply(null,r.call(arguments))}}function a(e){return function(){for(var t=c(arguments),r=t.length,n=0;n<r;n++)if(!e.call(null,t[n]))return!1;return!0}}function o(e){return function(){for(var t=c(arguments),r=t.length,n=0;n<r;n++)if(e.call(null,t[n]))return!0;return!1}}var s={"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t}};function u(e,t){var r=t+"",n=+(r.match(/\d+/)||NaN),i=r.match(/^[<>]=?|/)[0];return s[i]?s[i](e,n):e==n||n!=n}function c(t){var n=r.call(t);return 1===n.length&&e.array(n[0])&&(n=n[0]),n}e.arguments=function(e){return"[object Arguments]"===t.call(e)||null!=e&&"object"==typeof e&&"callee"in e},e.array=Array.isArray||function(e){return"[object Array]"===t.call(e)},e.boolean=function(e){return!0===e||!1===e||"[object Boolean]"===t.call(e)},e.char=function(t){return e.string(t)&&1===t.length},e.date=function(e){return"[object Date]"===t.call(e)},e.domNode=function(t){return e.object(t)&&t.nodeType>0},e.error=function(e){return"[object Error]"===t.call(e)},e.function=function(e){return"[object Function]"===t.call(e)||"function"==typeof e},e.json=function(e){return"[object Object]"===t.call(e)},e.nan=function(e){return e!=e},e.null=function(e){return null===e},e.number=function(r){return e.not.nan(r)&&"[object Number]"===t.call(r)},e.object=function(e){return Object(e)===e},e.regexp=function(e){return"[object RegExp]"===t.call(e)},e.sameType=function(r,n){var i=t.call(r);return i===t.call(n)&&("[object Number]"!==i||!e.any.nan(r,n)||e.all.nan(r,n))},e.sameType.api=["not"],e.string=function(e){return"[object String]"===t.call(e)},e.undefined=function(e){return void 0===e},e.windowObject=function(e){return null!=e&&"object"==typeof e&&"setInterval"in e},e.empty=function(t){if(e.object(t)){var r=Object.getOwnPropertyNames(t).length;return!!(0===r||1===r&&e.array(t)||2===r&&e.arguments(t))}return""===t},e.existy=function(e){return null!=e},e.falsy=function(e){return!e},e.truthy=i(e.falsy),e.above=function(t,r){return e.all.number(t,r)&&t>r},e.above.api=["not"],e.decimal=function(t){return e.number(t)&&t%1!=0},e.equal=function(t,r){return e.all.number(t,r)?t===r&&1/t==1/r:e.all.string(t,r)||e.all.regexp(t,r)?""+t==""+r:!!e.all.boolean(t,r)&&t===r},e.equal.api=["not"],e.even=function(t){return e.number(t)&&t%2==0},e.finite=isFinite||function(t){return e.not.infinite(t)&&e.not.nan(t)},e.infinite=function(e){return e===1/0||e===-1/0},e.integer=function(t){return e.number(t)&&t%1==0},e.negative=function(t){return e.number(t)&&t<0},e.odd=function(t){return e.number(t)&&t%2==1},e.positive=function(t){return e.number(t)&&t>0},e.under=function(t,r){return e.all.number(t,r)&&t<r},e.under.api=["not"],e.within=function(t,r,n){return e.all.number(t,r,n)&&t>r&&t<n},e.within.api=["not"];var l={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([\/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/};function h(t,r){e[t]=function(e){return r[t].test(e)}}for(var d in l)l.hasOwnProperty(d)&&h(d,l);e.ip=function(t){return e.ipv4(t)||e.ipv6(t)},e.capitalized=function(t){if(e.not.string(t))return!1;for(var r=t.split(" "),n=0;n<r.length;n++){var i=r[n];if(i.length){var a=i.charAt(0);if(a!==a.toUpperCase())return!1}}return!0},e.endWith=function(t,r){if(e.not.string(t))return!1;r+="";var n=t.length-r.length;return n>=0&&t.indexOf(r,n)===n},e.endWith.api=["not"],e.include=function(e,t){return e.indexOf(t)>-1},e.include.api=["not"],e.lowerCase=function(t){return e.string(t)&&t===t.toLowerCase()},e.palindrome=function(t){if(e.not.string(t))return!1;for(var r=(t=t.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).length-1,n=0,i=Math.floor(r/2);n<=i;n++)if(t.charAt(n)!==t.charAt(r-n))return!1;return!0},e.space=function(t){if(e.not.char(t))return!1;var r=t.charCodeAt(0);return r>8&&r<14||32===r},e.startWith=function(t,r){return e.string(t)&&0===t.indexOf(r)},e.startWith.api=["not"],e.upperCase=function(t){return e.string(t)&&t===t.toUpperCase()};var f=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],m=["january","february","march","april","may","june","july","august","september","october","november","december"];e.day=function(t,r){return e.date(t)&&r.toLowerCase()===f[t.getDay()]},e.day.api=["not"],e.dayLightSavingTime=function(e){var t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1),n=Math.max(t.getTimezoneOffset(),r.getTimezoneOffset());return e.getTimezoneOffset()<n},e.future=function(t){var r=new Date;return e.date(t)&&t.getTime()>r.getTime()},e.inDateRange=function(t,r,n){if(e.not.date(t)||e.not.date(r)||e.not.date(n))return!1;var i=t.getTime();return i>r.getTime()&&i<n.getTime()},e.inDateRange.api=["not"],e.inLastMonth=function(t){return e.inDateRange(t,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date)},e.inLastWeek=function(t){return e.inDateRange(t,new Date((new Date).setDate((new Date).getDate()-7)),new Date)},e.inLastYear=function(t){return e.inDateRange(t,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date)},e.inNextMonth=function(t){return e.inDateRange(t,new Date,new Date((new Date).setMonth((new Date).getMonth()+1)))},e.inNextWeek=function(t){return e.inDateRange(t,new Date,new Date((new Date).setDate((new Date).getDate()+7)))},e.inNextYear=function(t){return e.inDateRange(t,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1)))},e.leapYear=function(t){return e.number(t)&&(t%4==0&&t%100!=0||t%400==0)},e.month=function(t,r){return e.date(t)&&r.toLowerCase()===m[t.getMonth()]},e.month.api=["not"],e.past=function(t){var r=new Date;return e.date(t)&&t.getTime()<r.getTime()},e.quarterOfYear=function(t,r){return e.date(t)&&e.number(r)&&r===Math.floor((t.getMonth()+3)/3)},e.quarterOfYear.api=["not"],e.today=function(t){var r=(new Date).toDateString();return e.date(t)&&t.toDateString()===r},e.tomorrow=function(t){var r=new Date,n=new Date(r.setDate(r.getDate()+1)).toDateString();return e.date(t)&&t.toDateString()===n},e.weekend=function(t){return e.date(t)&&(6===t.getDay()||0===t.getDay())},e.weekday=i(e.weekend),e.year=function(t,r){return e.date(t)&&e.number(r)&&r===t.getFullYear()},e.year.api=["not"],e.yesterday=function(t){var r=new Date,n=new Date(r.setDate(r.getDate()-1)).toDateString();return e.date(t)&&t.toDateString()===n};var g=e.windowObject("object"==typeof p&&p)&&p,v=e.windowObject("object"==typeof self&&self)&&self,y=e.windowObject("object"==typeof this&&this)&&this,k=g||v||y||Function("return this")(),w=v&&v.document,_=k.is,b=v&&v.navigator,x=(b&&b.appVersion||"").toLowerCase(),D=(b&&b.userAgent||"").toLowerCase(),E=(b&&b.vendor||"").toLowerCase();function L(){var t=e;for(var r in t)if(n.call(t,r)&&e.function(t[r]))for(var s=t[r].api||["not","all","any"],u=0;u<s.length;u++)"not"===s[u]&&(e.not[r]=i(e[r])),"all"===s[u]&&(e.all[r]=a(e[r])),"any"===s[u]&&(e.any[r]=o(e[r]))}return e.android=function(){return/android/.test(D)},e.android.api=["not"],e.androidPhone=function(){return/android/.test(D)&&/mobile/.test(D)},e.androidPhone.api=["not"],e.androidTablet=function(){return/android/.test(D)&&!/mobile/.test(D)},e.androidTablet.api=["not"],e.blackberry=function(){return/blackberry/.test(D)||/bb10/.test(D)},e.blackberry.api=["not"],e.chrome=function(e){var t=/google inc/.test(E)?D.match(/(?:chrome|crios)\/(\d+)/):null;return null!==t&&u(t[1],e)},e.chrome.api=["not"],e.desktop=function(){return e.not.mobile()&&e.not.tablet()},e.desktop.api=["not"],e.edge=function(e){var t=D.match(/edge\/(\d+)/);return null!==t&&u(t[1],e)},e.edge.api=["not"],e.firefox=function(e){var t=D.match(/(?:firefox|fxios)\/(\d+)/);return null!==t&&u(t[1],e)},e.firefox.api=["not"],e.ie=function(e){var t=D.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==t&&u(t[1],e)},e.ie.api=["not"],e.ios=function(){return e.iphone()||e.ipad()||e.ipod()},e.ios.api=["not"],e.ipad=function(e){var t=D.match(/ipad.+?os (\d+)/);return null!==t&&u(t[1],e)},e.ipad.api=["not"],e.iphone=function(e){var t=D.match(/iphone(?:.+?os (\d+))?/);return null!==t&&u(t[1]||1,e)},e.iphone.api=["not"],e.ipod=function(e){var t=D.match(/ipod.+?os (\d+)/);return null!==t&&u(t[1],e)},e.ipod.api=["not"],e.linux=function(){return/linux/.test(x)},e.linux.api=["not"],e.mac=function(){return/mac/.test(x)},e.mac.api=["not"],e.mobile=function(){return e.iphone()||e.ipod()||e.androidPhone()||e.blackberry()||e.windowsPhone()},e.mobile.api=["not"],e.offline=i(e.online),e.offline.api=["not"],e.online=function(){return!b||!0===b.onLine},e.online.api=["not"],e.opera=function(e){var t=D.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==t&&u(t[1],e)},e.opera.api=["not"],e.phantom=function(e){var t=D.match(/phantomjs\/(\d+)/);return null!==t&&u(t[1],e)},e.phantom.api=["not"],e.safari=function(e){var t=D.match(/version\/(\d+).+?safari/);return null!==t&&u(t[1],e)},e.safari.api=["not"],e.tablet=function(){return e.ipad()||e.androidTablet()||e.windowsTablet()},e.tablet.api=["not"],e.touchDevice=function(){return!!w&&("ontouchstart"in v||"DocumentTouch"in v&&w instanceof DocumentTouch)},e.touchDevice.api=["not"],e.windows=function(){return/win/.test(x)},e.windows.api=["not"],e.windowsPhone=function(){return e.windows()&&/phone/.test(D)},e.windowsPhone.api=["not"],e.windowsTablet=function(){return e.windows()&&e.not.windowsPhone()&&/touch/.test(D)},e.windowsTablet.api=["not"],e.propertyCount=function(t,r){if(e.not.object(t)||e.not.number(r))return!1;var i=0;for(var a in t)if(n.call(t,a)&&++i>r)return!1;return i===r},e.propertyCount.api=["not"],e.propertyDefined=function(t,r){return e.object(t)&&e.string(r)&&r in t},e.propertyDefined.api=["not"],e.inArray=function(t,r){if(e.not.array(r))return!1;for(var n=0;n<r.length;n++)if(r[n]===t)return!0;return!1},e.inArray.api=["not"],e.sorted=function(t,r){if(e.not.array(t))return!1;for(var n=s[r]||s[">="],i=1;i<t.length;i++)if(!n(t[i],t[i-1]))return!1;return!0},L(),e.setNamespace=function(){return k.is=_,this},e.setRegexp=function(e,t){for(var r in l)n.call(l,r)&&t===r&&(l[r]=e)},e}();var he=le.exports;class de{static log(e){console.log(e)}static warn(e){console.warn(e)}static error(e){console.error(e)}static timeStamp(e){console.timeStamp&&console.timeStamp(e)}}function fe(e){return"number"==typeof e&&!Number.isNaN(e)}class pe{constructor(){this.width=null,this.height=null,this.video=null,this.stream=null,this.imposeContraint=!0,this.facingMode=null,this.deviceId=null}hasStream(){return this.video&&null!=this.video.srcObject}create(e){return new Promise(((t,r)=>{const n=this;if(void 0===e)return de.error("params must be provided"),void r();const i=e.width,a=e.height,o=e.frameRateConstraint,s=e.resizeModeConstraint;n.facingMode=e.facingMode,n.deviceId=e.deviceId,n.video=document.createElement("video"),n.video.setAttribute("playsinline",!0),n.getStream(i,a,o,s).then(t).catch(r)}))}getSource(){return this.video}getWidth(){return this.video.videoWidth}getHeight(){return this.video.videoHeight}getStream(e,t,r,n){const i=this;return new Promise(((a,o)=>{const s=s=>{i.imposeContraint&&"undefined"!=typeof OverconstrainedError&&s instanceof OverconstrainedError?(de.error(s),de.error("re-attempting getUserMedia without constraints (this is likely iOS safari)"),i.imposeContraint=!1,i.getStream(e,t,r,n).then(a).catch(o)):(de.error(s),o())};navigator||s(),navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.mediaDevices.getUserMedia||s();let u={};if(u.facingMode={ideal:i.facingMode},null!==i.deviceId&&(u.deviceId={ideal:i.deviceId}),"crop-and-scale"!=n&&"none"!=n||(u.resizeMode={ideal:n}),fe(r)&&fe(e)&&fe(t)&&this.imposeContraint){const n=window.matchMedia("(orientation: portrait)").matches,i=n?t:e,a=n?e:t;u.width={ideal:i},u.height={ideal:a},u.frameRate={ideal:r}}de.log(`getUserMedia videoConstraints: ${JSON.stringify(u)}`),navigator.mediaDevices.getUserMedia({video:u}).then((e=>{i.stream=e,navigator.userAgent.match(/UCBrowser/i)?i.video.onloadeddata=()=>{i.video.onloadeddata=null,a({width:i.video.videoWidth,height:i.video.videoHeight})}:i.video.onloadedmetadata=()=>{const e=i.stream.getVideoTracks()[0].getSettings(),t=`video stream information: \n   deviceId: ${e.deviceId}\n   width: ${i.video.videoWidth}\n   height: ${i.video.videoHeight}\n   frameRate: ${e.frameRate}\n`;de.log(t),i.video.onloadedmetadata=null,a({width:i.video.videoWidth,height:i.video.videoHeight})},i.video.srcObject=e;const t=i.video.play();"undefined"!==t&&t.then((()=>{de.log("playing")}),(()=>{de.log("browser does not support auto start, show play button")}))})).catch(s)}))}pause(){const e=this;e.video&&e.stream?e.video.pause():de.log("WARN: video has not been loaded yet")}destroy(){if(this.video.pause(),this.video){const e=this.video.srcObject;if(e){e.getTracks().forEach((e=>{e.stop()})),this.video.srcObject=null}}}}function me(){return/iPad/i.test(navigator.userAgent)}function ge(){return/Pixel 4/i.test(navigator.userAgent)}class ve{constructor(){this.onAnimation=null,this.requestId=0}requestAnimationFrame(){const e=this;this.requestId=requestAnimationFrame((()=>{e._onFrame()}))}cancel(){0!==this.requestId&&cancelAnimationFrame(this.requestId),this.requestId=0}_onFrame(){this.onFrame&&this.onFrame()}}class ye{constructor(e){this.active=!1,this.listener=e}}CanvasRenderingContext2D.prototype.resetTransform||(CanvasRenderingContext2D.prototype.resetTransform=function(){this.setTransform(1,0,0,1,0,0)});class ke{constructor(e=!1,t=0){de.log("Camera object constructed"),ke.totalInstances+=1,ke.totalInstances>1&&de.error("Too many camera instances"),this.onFrame=null,this.isRunning=!1,this.lastFrameUpdateTime=0,this.frameListeners=[],this.animation=new ve,this.mediaSource=null,this.flipX=!0,this.flipY=e,this.facingMode="user",this.deviceId=null,this.rotate=t,this.canvas=null,this.context=null,this.iframeWidth=0,this.iframeHeight=0,this.prevVideoWidth=0,this.prevVideoHeight=0;const r=this;this.animation.onFrame=()=>{r._onFrame()},this.firstTime=!0,this.manuallyRetrieveFrames=!1}getVideoSource(){return this.mediaSource.getSource()}getSource(){return this.canvas}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}start(e,t,r=30,n="user",i="none"){return new Promise(((a,o)=>{if(this.isRunning)return void a(e,t);de.log("starting camera"),ke.hasWebCam||o(),this.isRunning=!0,(!fe(r)||r>30)&&(r=30),de.log(`Camera.defaultBackCameraDeviceId: ${ke.defaultBackCameraDeviceId}`),de.log(`Camera.defaultFrontCameraDeviceId: ${ke.defaultFrontCameraDeviceId}`),this.facingMode=n,"environment"===this.facingMode&&(this.deviceId=ke.defaultBackCameraDeviceId,me()&&(this.facingMode=null,r=null),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.flipX=!1)),"user"===this.facingMode&&null!==ke.defaultFrontCameraDeviceId&&ge()&&(this.deviceId=ke.defaultFrontCameraDeviceId);this.initMediaSourceIfNeeded(e,t,r,i).then((e=>a(e))).catch((()=>{this.isRunning=!1,o()}))}))}stop(){this.isRunning&&(de.log("stopping camera"),this.animation.cancel(),this.mediaSource.pause(),this.isRunning=!1)}releaseStream(){this.mediaSource&&this.mediaSource.destroy()}destroy(){this.mediaSource=null,ke.totalInstances=0,this.releaseStream(),this.animation.cancel(),this.onFrame=null,this.frameListeners=[],this.animation.onFrame=null}addFrameListener(e){const t=new ye(e);t.listener=e,t.active=!0,this.frameListeners.push(t);const r=this;return t.remove=()=>{for(let e=0;e<r.frameListeners.length;e+=1)if(r.frameListeners[e]===this){r.frameListeners.splice(e,1);break}},t}restartMediaSource(e,t,r,n){const i=this;return i.iframeWidth=e,i.iframeHeight=t,this.lastFrameUpdateTime=0,new Promise(((a,o)=>{this.mediaSource.getStream(e,t,r,n).then((()=>{i.resolveMediaSource(),a({width:e,height:t})})).catch(o)}))}hasStream(){return!!this.mediaSource&&this.mediaSource.hasStream()}initMediaSourceIfNeeded(e,t,r,n){return new Promise(((i,a)=>{if(null!==this.mediaSource)return void this.restartMediaSource(e,t,r,n).then((e=>i(e))).catch(a);this.mediaSource=new pe;const o=this;o.iframeWidth=e,o.iframeHeight=t;const s={width:e,height:t,mode:"live",resizeModeConstraint:n,frameRateConstraint:r,facingMode:o.facingMode,deviceId:o.deviceId};this.mediaSource.create(s).then((()=>{o.resolveMediaSource(),i({width:e,height:t})})).catch(a)}))}resizeMainimContainer(){let e=this.mediaSource.getWidth(),t=this.mediaSource.getHeight();if(90!==this.rotate&&270!==this.rotate||(e=this.mediaSource.getHeight(),t=this.mediaSource.getWidth()),this.canvas.width===this.iframeWidth&&this.canvas.height===this.iframeHeight&&this.prevVideoWidth===e&&this.prevVideoHeight===t)return;this.prevVideoWidth=e,this.prevVideoHeight=t,this.canvas.width=this.iframeWidth,this.canvas.height=this.iframeHeight;const r=this.canvas.width/e,n=this.canvas.height/t;this.context.resetTransform(),this.canvas.width/this.canvas.height>e/t?(this.context.translate(0,-(r/n-1)*this.canvas.height/2),this.context.scale(1,r/n)):(this.context.translate(-(n/r-1)*this.canvas.width/2,0),this.context.scale(n/r,1));let i=1,a=1,o=0,s=0,u=this.rotate;this.flipX&&(i=-1,o=this.canvas.width,u=(-1*u+360)%360),this.flipY&&(a=-1,s=this.canvas.height,u=(-1*u+360)%360),(this.flipX||this.flipY)&&(this.context.translate(o,s),this.context.scale(i,a));if(![90,180,270].includes(u))return;let c=this.canvas.width/2,l=this.canvas.height/2;90===u?l=c:270===u&&(c=l),this.context.translate(c,l),this.context.rotate(u*Math.PI/180),this.context.translate(-1*c,-1*l)}resolveMediaSource(){this.canvas=function(e,t){const r=document.createElement("canvas");return r.width=e,r.height=t,r.style.background="rgb(255,255,255)",r}(100,100),this.context=this.canvas.getContext("2d"),this.resizeMainimContainer(),this.manuallyRetrieveFrames||this._onFrame()}getCurrentFrame(){return this.resizeMainimContainer(),this.updateCanvas(),this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height)}_onFrame(){if(this.resizeMainimContainer(),!this.isRunning||!this.updateCanvas())return void this.animation.requestAnimationFrame();const e=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height);this.frameListeners.forEach((t=>{t.active&&t.listener(e)})),this.onFrame&&this.onFrame(e),this.animation.requestAnimationFrame()}updateCanvas(){const e=this.mediaSource.getSource();return!(e.currentTime<=this.lastFrameUpdateTime)&&(90===this.rotate||270===this.rotate?this.context.drawImage(e,0,0,this.canvas.height,this.canvas.width):this.context.drawImage(e,0,0,this.canvas.width,this.canvas.height),this.lastFrameUpdateTime=e.currentTime,!0)}}ke.totalInstances=0,ke.hasCamCheckDone=!1,ke.cameraCheckListeners=[],ke.addCameraCheckListener=e=>{ke.hasCamCheckDone?e():ke.cameraCheckListeners.push(e)},function(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=e=>{navigator.mediaDevices.enumerateDevices().then(e)});let e=[];const t="https:"===window.location.protocol;let r=!1;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(r=!0);let n=!1,i=!1,a=!1,o=!1,s=!1,u=null,c=null;var l;l=()=>{"boolean"!=typeof a&&(a=!0),ke.hasWebCam=a,he.ios(),ke.hasMicrophone=n,ke.hasSpeakers=i,ke.isWebCamInUse=s,ke.defaultBackCameraDeviceId=u,ke.defaultFrontCameraDeviceId=c,ke.hasCamCheckDone=!0,ke.canTakePhoto=he.mobile()||he.tablet()||a,r&&!a&&(ke.canTakePhoto=!1),de.log(`hasWebCam: ${a}`),de.log(`hasMicrophone: ${n}`),de.log(`isMicrophoneAlreadyCaptured: ${o}`),de.log(`isWebcamAlreadyCaptured: ${s}`),de.log(`defaultBackCameraDeviceId: ${u}`),de.log(`defaultFrontCameraDeviceId: ${c}`);for(let e=0;e<ke.cameraCheckListeners.length;e+=1)ke.cameraCheckListeners[e]();ke.cameraCheckListeners=null},he.safari(10)&&(r=!1),r?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(e=[],navigator.enumerateDevices((r=>{de.log("all devices"),de.log(JSON.stringify(r)),r.forEach((r=>{const l={};for(const e in r)l[e]=r[e];let h;"audio"===l.kind&&(l.kind="audioinput"),"video"===l.kind&&(l.kind="videoinput"),e.forEach((e=>{e.id===l.id&&e.kind===l.kind&&(h=!0)})),h||(l.deviceId||(l.deviceId=l.id),l.id||(l.id=l.deviceId),me()&&"videoinput"===l.kind&&null===u&&(u=l.id),l.label?("videoinput"!==l.kind||s||(s=!0),"audioinput"!==l.kind||o||(o=!0),me()||-1===l.label.indexOf("back")||-1===l.label.indexOf("0")||(u=l.id),ge()&&"videoinput"===l.kind&&-1!==l.label.indexOf("camera2 1")&&-1!==l.label.indexOf("front")&&null===c&&(c=l.id)):(l.label="Please invoke getUserMedia once.",t||(l.label=`HTTPs is required to get label of this ${l.kind} device.`)),"audioinput"===l.kind&&(n=!0),"audiooutput"===l.kind&&(i=!0),"videoinput"===l.kind&&(a=!0),e.push(l))})),l&&l()}))):l&&l()):l()&&l()}();var we=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a(this,e),this.width=null,this.height=null,this.flipY=t,this.rotate=i,this.setResizeMode(n),this.camera=null!==r?r:new ke(this.flipY,this.rotate),this.camera.manuallyRetrieveFrames=!0}return s(e,[{key:"hasStream",value:function(){return this.camera.hasStream()}},{key:"start",value:function(e,t){return this.width=e,this.height=t,this.play()}},{key:"setResizeMode",value:function(e){this.resizeModeConstraint=e}},{key:"isRunning",value:function(){return this.camera.isRunning}},{key:"getVideoSource",value:function(){return this.camera.getVideoSource()}},{key:"getCurrentFrame",value:function(){return this.camera.getCurrentFrame()}},{key:"addFrameListener",value:function(e){this.camera.addFrameListener(e)}},{key:"requestStream",value:function(){return this.play()}},{key:"pause",value:function(){this.camera.stop()}},{key:"play",value:function(){return this.camera.start(this.width,this.height,void 0,void 0,this.resizeModeConstraint)}},{key:"releaseStream",value:function(){this.camera.releaseStream()}},{key:"destroy",value:function(){this.camera.destroy()}},{key:"getSource",value:function(){return this}},{key:"getWidth",value:function(){return this.camera.getWidth()}},{key:"getHeight",value:function(){return this.camera.getHeight()}}]),e}();function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,s=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_e(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xe=function(){function e(){a(this,e),this.onCreationComplete=null,this.onResetComplete=null,this.width=0,this.height=0,this.maxFaces=1,this.mainTracker=null,this.trackerLoaded=!1,this.trackerWaiting=!1,this.allowDownscaling=!0,this.enableLightingCheck=!0,this.lightingCheckThreshold=.3,this.detectFaceMasks=!1,this.performanceData={reset:function(){this.trackTime=new ue},getAverages:function(){return{avgTrackTime:this.trackTime.getAverageTime()}}},this.performanceData.reset(),this.reset()}var t;return s(e,[{key:"setAllowDownscaling",value:function(e){this.allowDownscaling=!!e}},{key:"getDetectionResult",value:function(){return this.detectionResult}},{key:"setEnableLightingCheck",value:function(e){this.enableLightingCheck=e,this.mainTracker&&(this.mainTracker.enableLightingCheck=e)}},{key:"getEnableLightingCheck",value:function(){return this.enableLightingCheck}},{key:"setLightingCheckThreshold",value:function(e){this.lightingCheckThreshold=e,this.mainTracker&&(this.mainTracker.lightingCheckThreshold=e)}},{key:"getLightingCheckThreshold",value:function(){return this.lightingCheckThreshold}},{key:"reset",value:function(){return this.stopTracker=!1,this.performanceData.reset(),this.trackerLoaded&&this.mainTracker.reset(),Promise.resolve()}},{key:"create",value:function(){var t=this;return e.loadFaceTrackerLibrary().then((function(){return t.mainTracker=new MFEFaceTracker.FaceTracker,t.mainTracker.maxFaces=t.maxFaces,t.mainTracker.licenceKey=trackerLicenceKey,t.mainTracker.enableLightingCheck=t.enableLightingCheck,t.mainTracker.lightingCheckThreshold=t.lightingCheckThreshold,t.mainTracker.lightingCheckingInterval=25,t.mainTracker.detectFaceMasks=t.detectFaceMasks,t.mainTracker.instantiateWasmOverride=function(t,r){return WebAssembly.instantiate(e.faceTrackerData.faceTrackerEMWasmModule,t).then((function(e){r(e)})),{}},t.mainTracker.load(e.faceTrackerData,!0)})).then((function(){t.trackerLoaded=!0}))}},{key:"destroy",value:function(){this.mainTracker&&(this.mainTracker.destroy(),this.mainTracker=null,this.trackerLoaded=!1)}},{key:"stop",value:function(){this.stopTracker=!0}},{key:"warmup",value:function(){return this.mainTracker?this.mainTracker.warmup():Promise.reject(new Error("tracker warmup called, but tracker does not exist"))}},{key:"setMaxFaces",value:function(e){this.maxFaces=e,this.mainTracker&&(this.mainTracker.maxFaces=e)}},{key:"getMaxFaces",value:function(){return this.maxFaces}},{key:"setDetectFaceMasks",value:function(e){this.detectFaceMasks=e,this.mainTracker&&(this.mainTracker.detectFaceMasks=this.detectFaceMasks)}},{key:"track",value:(t=i(k.mark((function e(t){var r,n,i,a,o;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.stopTracker&&!this.trackerWaiting&&this.trackerLoaded){e.next=2;break}return e.abrupt("return",null);case 2:return this.width=t.width,this.height=t.height,this.trackerWaiting=!0,r=new Uint8Array(t.data),n=new MFEFaceTracker.PixelData(r,t.width,t.height),this.performanceData.trackTime.begin(),e.next=10,this.mainTracker.detectMulti(n);case 10:return i=e.sent,this.performanceData.trackTime.end(),a=i.faces.length>0,this.trackerWaiting=!1,this.detectionResult=i,o=a?this.detectionResult:null,a&&(this.detectionResult.faces.forEach((function(e){e.isBadLighting=!!e.isBadLighting})),this.detectionResult.isBadLighting=this.detectionResult.faces.some((function(e){return e.isBadLighting}))),e.abrupt("return",{detectionResult:o,imageData:t});case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"loadFaceTrackerLibrary",value:function(){if("undefined"==typeof MFEFaceTracker){var t,r,n=MF_MODULE_LOADER,i=n.dataPromises,a=n.wasmModulePromises,o=i.faceTrackerSourceMain,s=i.faceBoxModelJSON,u=i.faceBoxModelData,c=i.facePointModelJSON,l=i.facePointModelData,h=a.faceTrackerEMWasmModule,d=null!==(t=i.faceMaskModelJSON)&&void 0!==t?t:Promise.resolve(),f=null!==(r=i.faceMaskModelData)&&void 0!==r?r:Promise.resolve();return Promise.all([o,s,u,c,l,d,f,h]).then((function(t){var r=be(t,8),n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],l=r[7];eval.call(window,n),e.faceTrackerData={faceBoxModelJSON:i,faceBoxWeightArray:a,facePointModelJSON:o,facePointWeightArray:s,tfWASMBackendPath:MF_MODULE_LOADER.trackerResourcesFolderUrl,faceTrackerEMWasmModule:l},u&&(e.faceTrackerData.faceMaskModelJSON=u),c&&(e.faceTrackerData.faceMaskWeightArray=c)}))}return Promise.resolve()}}]),e}(),De=function(){function e(t){a(this,e),this.source=null,this.tracker=t||new xe,this.trackingCompleteResolves=[],this.trackingCompleteRejects=[],this.sendInitialTrackingMessageRequested=!1,this.width=null,this.height=null,this.sourceWidth=0,this.sourceHeight=0,this.spareCanvas=null}return s(e,[{key:"create",value:function(){return this.loadTracker()}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setExtractorWidth",value:function(e){this.width=e}},{key:"setExtractorHeight",value:function(e){this.height=e}},{key:"setMaxFaces",value:function(e){this.tracker.setMaxFaces(e)}},{key:"getMaxFaces",value:function(){return this.tracker.getMaxFaces()}},{key:"setDetectFaceMasks",value:function(e){this.tracker.setDetectFaceMasks(e)}},{key:"loadTracker",value:function(){var e=this;return this.tracker.create().then((function(){e.sendInitialTrackingMessageRequested&&(e.sendInitialTrackingMessageRequested=!1,e.sendInitialTrackingMessage())}))}},{key:"getDetectionResult",value:function(){return this.tracker.getDetectionResult()}},{key:"getSingleDetectionResult",value:function(){var e=this.tracker.getDetectionResult();return e?e.faces[0]:null}},{key:"track",value:function(){return this.tracker.detectionResult}},{key:"sendInitialTrackingMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.tracker.trackerLoaded){this.updateCanvasFromSource(this.spareCanvas);var r=A(this.spareCanvas);this.tracker.reset(),this.tracker.track(r).then((function(r){e.handleTrackerResponse(r,t)}))}else this.sendInitialTrackingMessageRequested=!0}},{key:"updateCanvasFromSource",value:function(e){this.source||I("source needs to be set first"),e.getContext("2d").drawImage(this.source,0,0,e.width,e.height)}},{key:"destroy",value:function(){this.renderer=null,this.source=null,this.tracker.destroy(),this.tracker=null,this.sendInitialTrackingMessageRequested=!1}},{key:"handleTrackerResponse",value:function(){I("implement please")}},{key:"callRejects",value:function(e){for(var t=0;t<this.trackingCompleteRejects.length;t+=1)"function"==typeof this.trackingCompleteRejects[t]&&this.trackingCompleteRejects[t](e);this.trackingCompleteRejects=[],this.trackingCompleteResolves=[]}},{key:"callResolves",value:function(e){for(var t=0;t<this.trackingCompleteResolves.length;t+=1)"function"==typeof this.trackingCompleteResolves[t]&&this.trackingCompleteResolves[t](e);this.trackingCompleteRejects=[],this.trackingCompleteResolves=[]}}]),e}();function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var Le=function(e){d(r,e);var t=Ee(r);function r(e){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return a(this,r),(n=t.call(this,e)).flipX=i,n.canvasInitialized=!1,n.imageData=null,n}return s(r,[{key:"updateCanvasFromSource",value:function(e){this.source||I("source needs to be set first");var t=e.getContext("2d");R(1),t.putImageData(this.imageData,0,0)}},{key:"updateWithCurrentFrame",value:function(){this.imageData=this.source.getCurrentFrame(),R(1),this.updateCanvasFromSource(this.spareCanvas)}},{key:"getOutputAsync",value:function(){var e=this;this.updateWithCurrentFrame();var t=this.imageData;return this.tracker.track(t).then((function(r){return new z(r.detectionResult,t,e.spareCanvas)}))}},{key:"awaitTrackingComplete",value:function(){var e=this;return new Promise((function(t,r){e.trackingCompleteResolves.push(t),e.trackingCompleteRejects.push(r)}))}},{key:"setSource",value:function(e){return e instanceof we||I("source must be a VideoSource class"),e===this.source||(this.source=e,this.canvasInitialized||(this.spareCanvas=j(1,1),this.canvasInitialized=!0),this.onResize()),Promise.resolve()}},{key:"getPerformanceData",value:function(){return this.tracker.performanceData.getAverages()}},{key:"onResize",value:function(){if(this.source&&(this.sourceWidth!==this.source.getWidth()||this.sourceHeight!==this.source.getHeight())&&(this.sourceWidth=this.source.getWidth(),this.sourceHeight=this.source.getHeight(),"number"!=typeof this.width&&(this.width=this.sourceWidth),"number"!=typeof this.height&&(this.height=this.sourceHeight),this.spareCanvas.width=this.width,this.spareCanvas.height=this.height,this.flipX)){var e=this.spareCanvas.getContext("2d");e.translate(this.width,0),e.scale(-1,1)}}}]),r}(De);function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var Pe=function(e){d(n,e);var t,r=Ce(n);function n(){var e;return a(this,n),(e=r.call(this)).videoSource=null,e.videoDataExtractor=null,e.liveProcessId=-1,e.renderLoopActive=!1,e.boundOnOrientationChange=null,e.lightingThreshold=.3,e.flipY=!1,e.rotate=0,e.resizeMode="none",e}return s(n,[{key:"onOrientationChange",value:function(){var e=this;this.eventQueue.orientationChange||(this.eventQueue.orientationChange=Promise.resolve()),this.eventQueue.orientationChange=this.eventQueue.orientationChange.then((function(){return new Promise((function(t){e.fireEventListener("orientationChangeStart");var r=e.isPaused();r||e.pause(),e.videoSource.releaseStream(),setTimeout((function(){e.videoSource=new we(e.flipY,e.videoSource.camera,e.resizeMode,e.rotate),e.videoDataExtractor=new Le(e.videoDataExtractor.tracker),e.videoDataExtractor.setMaxFaces(e.maxFaces),e.videoDataExtractor.setDetectFaceMasks(e.detectFaceMasks),r?(e.releaseStream(),e.fireEventListener("orientationChangeEnd"),t()):e.play().then((function(){e.fireEventListener("orientationChangeEnd"),t()}))}),10)}))}))}},{key:"destroy",value:function(){this.releaseStream(),this.videoSource.destroy(),l(u(n.prototype),"destroy",this).call(this),this.videoDataExtractor.destroy(),this.videoSource=null,this.videoDataExtractor=null,this.renderLoopActive=!1,window.removeEventListener("orientationchange",this.boundOnOrientationChange)}},{key:"create",value:function(e){var t=this,r=e.width,i=void 0===r?640:r,a=e.height,o=void 0===a?480:a,s=e.lightingThreshold,c=void 0===s?.3:s,h=e.flipY,d=void 0!==h&&h,f=e.resourceResolver,p=void 0===f?null:f,m=e.camera,g=void 0===m?null:m,v=e.rotate,y=void 0===v?0:v,k=[l(u(n.prototype),"create",this).call(this,{resourceResolver:p})];this.mode="live",this.targetWidth=i,this.targetHeight=o,this.flipY=d,this.rotate=y,this.videoSource=new we(this.flipY,g,this.resizeMode,this.rotate),this.lightingThreshold=c;var w=this;return this.boundOnOrientationChange=function(e){w.onOrientationChange(e)},window.addEventListener("orientationchange",this.boundOnOrientationChange),this.videoDataExtractor=new Le,this.videoDataExtractor.setMaxFaces(this.maxFaces),this.videoDataExtractor.setDetectFaceMasks(this.detectFaceMasks),k.push(this.videoDataExtractor.create().then((function(){return t.videoDataExtractor.tracker.warmup(),Promise.resolve()}))),Promise.all(k)}},{key:"isPaused",value:function(){return!this.videoSource.isRunning()}},{key:"play",value:function(){var e=this;return(this.videoSource.hasStream()?Promise.resolve():this.requestStream()).then((function(){return e.videoSource.play()})).then((function(){return e.processVideo()}))}},{key:"pause",value:function(){this.videoSource.hasStream()&&this.videoSource.pause(),this.stopProcessingVideo()}},{key:"requestStream",value:function(){var e=this;return this.videoSource.start(this.targetWidth,this.targetHeight).then((function(t){e.trueWidth=t.width,e.trueHeight=t.height,e.makeupRenderer.resize(e.trueWidth,e.trueHeight)}))}},{key:"releaseStream",value:function(){this.pause(),this.videoSource.hasStream()&&this.videoSource.releaseStream()}},{key:"getDetectionResult",value:function(){return this.videoDataExtractor.getSingleDetectionResult()}},{key:"setResizeMode",value:function(e){this.resizeMode=e}},{key:"getMediaSource",value:function(){return this.videoSource}},{key:"setMaxFaces",value:function(e){l(u(n.prototype),"setMaxFaces",this).call(this,e),this.videoDataExtractor&&this.videoDataExtractor.setMaxFaces(e)}},{key:"renderLoopAsync",value:(t=i(k.mark((function e(){var t,r,n,i,a,o,s,u=this;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.videoSource||I("Requires a VideoSource"),e.next=3,this.videoDataExtractor.getOutputAsync();case 3:if(t=e.sent,this.renderLoopActive){e.next=6;break}return e.abrupt("return");case 6:if(!t){e.next=18;break}return this.videoDataExtractor.tracker.setLightingCheckThreshold(this.lightingThreshold),this.mediaData=t,e.next=11,this.render(this.mediaData);case 11:if(this.renderLoopActive){e.next=13;break}return e.abrupt("return");case 13:this.mediaData=null,!!(i=(null===(r=t.detectionResult)||void 0===r||null===(n=r.faces)||void 0===n?void 0:n.length)>0)&&!!t.detectionResult.faces[0].isBadLighting&&(this.eventQueue.badLighting||(this.eventQueue.badLighting=Promise.resolve()),this.eventQueue.badLighting=this.eventQueue.badLighting.then((function(){u.fireEventListener("badLighting")}))),this.detectFaceMasks&&i&&(a=!!t.detectionResult.faces[0].hasFaceMask,this.eventQueue.hasFaceMask||(this.eventQueue.hasFaceMask=Promise.resolve()),this.eventQueue.hasFaceMask=this.eventQueue.hasFaceMask.then((function(){u.fireEventListener("hasFaceMask",a)})));case 18:o=Me(Me({},this.videoDataExtractor.getPerformanceData()),this.performanceData.getAverages()),this.fireEventListener("performanceUpdate",o),s=this.renderLoopAsync.bind(this),this.liveProcessId=setTimeout(s,1);case 22:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"processVideo",value:function(){var e=this;return this.renderLoopActive?Promise.reject(new Error("A processVideo loop is already active")):this.videoDataExtractor.setSource(this.getSource()).then((function(){var t=e.videoDataExtractor.getWidth(),r=e.videoDataExtractor.getHeight();return e.makeupRenderer.resize(t,r),e.renderLoopActive=!0,e.renderLoopAsync()}))}},{key:"stopProcessingVideo",value:function(){window.clearTimeout(this.liveProcessId),this.liveProcessId=-1,this.renderLoopActive=!1}},{key:"getVideoSource",value:function(){return this.videoSource.getVideoSource()}}]),n}(ce),Fe=function(){function e(t,r){a(this,e),this.module=null,this.image=new Image,this.canvas=j(t,r),this.context=this.canvas.getContext("2d")}return s(e,[{key:"getSource",value:function(){return this.canvas}},{key:"getWidth",value:function(){return this.canvas.width}},{key:"getHeight",value:function(){return this.canvas.height}},{key:"checkMemorySize",value:function(e,t){return"undefined"==typeof Module||!Module||void 0===Module.TOTAL_MEMORY||e*t*4*8<=Module.TOTAL_MEMORY}},{key:"setImage",value:function(e,t){var r=this;return new Promise((function(n){var i=new Image;"data"!==e.split(":")[0]&&(i.crossOrigin="anonymous"),i.onload=function(){var e=i.naturalWidth,a=i.naturalHeight;t||r.checkMemorySize(e,a)?(r.image=i,r.canvas.width=e,r.canvas.height=a,r.updateCanvHelper(r.canvas,r.context),n({width:e,height:a})):I("memory_size")},i.onerror=function(){I("Error loading source:".concat(e))},i.src=e}))}},{key:"updateCanvHelper",value:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var r=e.width/this.image.width,n=e.height/this.image.height,i=Math.max(r,n),a=this.image.width*i,o=this.image.height*i,s=e.width/2-a/2,u=e.height/2-o/2;t.drawImage(this.image,s,u,a,o)}},{key:"destroy",value:function(){this.module=null,this.image=null,this.canvas=null,this.context=null}}]),e}();function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var Ae=function(e){d(r,e);var t=Te(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).presetDetectionResult=null,n.currentOutput=null,n.waitingForTracker=!1,n.tracker.setAllowDownscaling(!1),n.isPresetDetectionResultComplete=!1,n}return s(r,[{key:"awaitOutput",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.currentOutput)return Promise.resolve(this.currentOutput);var n=new Promise((function(t,r){e.trackingCompleteResolves.push(t),e.trackingCompleteRejects.push(r)}));if(!this.waitingForTracker)if(this.isPresetDetectionResultComplete){var i=r.convertToMultiFaceDetectionResult(this.presetDetectionResult);this.handleTrackerResponse({detectionResult:i,imageData:A(this.spareCanvas)},t)}else this.waitingForTracker=!0,this.sendInitialTrackingMessage(t);return n.then((function(){return e.currentOutput}))}},{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e instanceof HTMLCanvasElement||I("source must be an HTMLCanvasElement"),this.source=e,this.onResize(),this.updateCanvasFromSource(this.spareCanvas),this.imageData=A(this.source),this.currentOutput=null,t?Promise.resolve():this.tracker.reset()}},{key:"setPresetDetectionResult",value:function(e,t){this.presetDetectionResult=r.processPresetDetectionResult(e,t),this.isPresetDetectionResultComplete=t}},{key:"handleTrackerResponse",value:function(e){var t,r=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e||I("Cannot handle an empty facetracker response.");var i=e.detectionResult,a=e.imageData,o=(null==i||null===(t=i.faces)||void 0===t?void 0:t.length)>0;if(o&&this.presetDetectionResult){var s=i.faces[0],u=["allPoints","facebox","origFacebox","targetOrigFacebox"];u.forEach((function(e){r.presetDetectionResult[e]&&(s[e]=r.presetDetectionResult[e])})),this.presetDetectionResult.facePoints&&Object.assign(s.facePoints,this.presetDetectionResult.facePoints)}this.currentOutput=new z(i,a,this.spareCanvas),this.waitingForTracker=!1,n||o?this.callResolves():this.callRejects("Unable to detect face in photo")}},{key:"onResize",value:function(){this.source&&(this.width=this.source.width,this.height=this.source.height,this.spareCanvas=j(this.width,this.height))}}],[{key:"convertToMultiFaceDetectionResult",value:function(e){return{faces:[e],timings:e.timings,isBadLighting:e.isBadLighting}}},{key:"processPresetDetectionResult",value:function(e,t){if(!t)return e;var r,n,i,a,o,s=e.facePoints,u={rightEyeInnerCorner3D:{x:32.6,y:27.1,z:196.5},leftEyeInnerCorner3D:{x:-32.6,y:27.1,z:196.5},rightEyeOuterCorner3D:{x:105.64,y:26.87,z:185.49},leftEyeOuterCorner3D:{x:-105.638,y:26.87,z:185.49},rightNose3D:{x:32.56,y:-20.73,z:206.17},leftNose3D:{x:-32.56,y:-20.73,z:206.17},modelViewProjectionMatrix:(r=s.projectionViewMatrix,n=s.modelMatrix,i=r,a=n,o=function(e,t){return i[4*e]*a[t]+i[4*e+1]*a[t+4]+i[4*e+2]*a[t+8]+i[4*e+3]*a[t+12]},[o(0,0),o(0,1),o(0,2),o(0,3),o(1,0),o(1,1),o(1,2),o(1,3),o(2,0),o(2,1),o(2,2),o(2,3)]),faceTranslation:{x:0,y:0,z:0}};if(Object.keys(u).some((function(e){return!s[e]}))){O("Warning: the passed in points were generated with an older version of the face tracker. For best results please re-run the face tracker on the image.");var c=Re({},s);Object.keys(u).forEach((function(e){c[e]||(c[e]=u[e])}));var l=Re({},e);return l.facePoints=c,l}return e}}]),r}(De);function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var je=function(e){d(n,e);var t,r=Ie(n);function n(){var e;return a(this,n),(e=r.call(this)).imageSource=null,e.canvasDataExtractor=null,e}return s(n,[{key:"destroy",value:function(){l(u(n.prototype),"destroy",this).call(this),this.imageSource.destroy(),this.canvasDataExtractor.destroy(),this.imageSource=null,this.canvasDataExtractor=null}},{key:"create",value:function(e){var t=e.resourceResolver,r=void 0===t?null:t,i=[l(u(n.prototype),"create",this).call(this,{resourceResolver:r})];return this.mode="photo",this.imageSource=new Fe,this.canvasDataExtractor=new Ae,this.canvasDataExtractor.setMaxFaces(this.maxFaces),this.canvasDataExtractor.setDetectFaceMasks(this.detectFaceMasks),i.push(this.canvasDataExtractor.create()),Promise.all(i)}},{key:"setImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this;n.unsetMouthOpen(),this.makeupRenderer.resetTrackerData();var i=n.imageSource.image.src;return new Promise((function(a,o){n.canvasDataExtractor.setPresetDetectionResult({},!1),n.imageSource.setImage(e).then((function(){return void 0!==t&&n.canvasDataExtractor.setPresetDetectionResult(t,r),n.processImage().then((function(){var e=r?t:n.getDetectionResult();a(e)}))})).catch((function(e){console.error("setImage: ".concat(e)),i&&n.hasValidFace&&n.setImage(i).then((function(){return o(e)})),o(e)}))}))}},{key:"setImageNativeLive",value:function(e){var t=this;return t.unsetMouthOpen(),t.imageSource.setImage(e).then((function(){return t.processImage({isNativeLive:!0}).catch((function(e){return Promise.reject(e)}))}))}},{key:"setDetectionResult",value:function(e){return this.canvasDataExtractor.setPresetDetectionResult(e),this.processImage()}},{key:"getDetectionResult",value:function(){return this.canvasDataExtractor.getSingleDetectionResult()}},{key:"getMediaSource",value:function(){return this.imageSource}},{key:"setMaxFaces",value:function(e){l(u(n.prototype),"setMaxFaces",this).call(this,e),this.canvasDataExtractor&&this.canvasDataExtractor.setMaxFaces(e)}},{key:"processImage",value:(t=i(k.mark((function e(){var t,r,n,i,a=this,o=arguments;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{isNativeLive:!1},e.next=3,this.canvasDataExtractor.setSource(this.getSource(),t.isNativeLive);case 3:return this.makeupRenderer.resize(this.canvasDataExtractor.getWidth(),this.canvasDataExtractor.getHeight()),e.next=6,this.canvasDataExtractor.awaitOutput(t.isNativeLive);case 6:return r=e.sent,this.hasValidFace=!0,this.mediaData=r,this.makeupRenderer.setMediaData(r,!0),e.next=12,this.render(this.mediaData);case 12:return n=this.getDetectionResult(),this.detectFaceMasks&&null!=n&&(i=n.hasFaceMask,this.eventQueue.hasFaceMask||(this.eventQueue.hasFaceMask=Promise.resolve()),this.eventQueue.hasFaceMask=this.eventQueue.hasFaceMask.then((function(){a.fireEventListener("hasFaceMask",i)}))),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),n}(ce);function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var Ne=function(e){d(n,e);var t,r=Be(n);function n(){var e;return a(this,n),(e=r.call(this)).videoSource=null,e.videoDataExtractor=null,e.liveProcessId=-1,e.renderLoopActive=!1,e.boundOnOrientationChange=null,e.lightingThreshold=.3,e}return s(n,[{key:"onOrientationChange",value:function(){var e=this;this.eventQueue.orientationChange||(this.eventQueue.orientationChange=Promise.resolve()),this.eventQueue.orientationChange=this.eventQueue.orientationChange.then((function(){return new Promise((function(t){e.fireEventListener("orientationChangeStart");var r=e.isPaused();r||e.pause(),e.videoSource.releaseStream(),setTimeout((function(){e.videoSource=new we,e.videoDataExtractor=new Le(e.videoDataExtractor.tracker),r?(e.releaseStream(),e.fireEventListener("orientationChangeEnd"),t()):e.play().then((function(){e.fireEventListener("orientationChangeEnd"),t()}))}),10)}))}))}},{key:"destroy",value:function(){this.releaseStream(),this.videoSource.destroy(),l(u(n.prototype),"destroy",this).call(this),this.videoDataExtractor.destroy(),this.videoSource=null,this.videoDataExtractor=null,this.renderLoopActive=!1,window.removeEventListener("orientationchange",this.boundOnOrientationChange)}},{key:"create",value:function(e){var t=e.width,r=void 0===t?640:t,i=e.height,a=void 0===i?480:i,o=e.lightingThreshold,s=void 0===o?.3:o,c=[l(u(n.prototype),"create",this).call(this)];this.mode="live",this.targetWidth=r,this.targetHeight=a,this.lightingThreshold=s,this.videoSource=new we;var h=this;return this.boundOnOrientationChange=function(e){h.onOrientationChange(e)},window.addEventListener("orientationchange",this.boundOnOrientationChange),this.videoDataExtractor=new Le,c.push(this.videoDataExtractor.create()),Promise.all(c)}},{key:"createTutorial",value:function(e,t){return this.makeupRenderer.playTutorial(e,t)}},{key:"isPaused",value:function(){return!this.videoSource.isRunning()}},{key:"play",value:function(){var e=this;return(this.videoSource.hasStream()?Promise.resolve():this.requestStream()).then((function(){return e.videoSource.play()})).then((function(){return e.makeupRenderer.resumeTutorial(),e.processVideo()}))}},{key:"pause",value:function(){this.videoSource.hasStream()&&(this.makeupRenderer.pauseTutorial(),this.videoSource.pause()),this.stopProcessingVideo()}},{key:"pauseTutorial",value:function(){this.videoSource.hasStream()&&this.makeupRenderer.pauseTutorial()}},{key:"resumeTutorial",value:function(){this.videoSource.hasStream()&&this.makeupRenderer.resumeTutorial()}},{key:"getStep",value:function(){return this.makeupRenderer.getTutorialStep()}},{key:"setStep",value:function(e){this.makeupRenderer.setTutorialStep(e)}},{key:"setPlayCount",value:function(e){this.makeupRenderer.setPlayCount(e)}},{key:"stopTutorial",value:function(){this.makeupRenderer.stopTutorial()}},{key:"requestStream",value:function(){var e=this;return this.videoSource.start(this.targetWidth,this.targetHeight).then((function(t){e.trueWidth=t.width,e.trueHeight=t.height,e.makeupRenderer.resize(e.trueWidth,e.trueHeight)}))}},{key:"releaseStream",value:function(){this.pause(),this.videoSource.hasStream()&&this.videoSource.releaseStream()}},{key:"getDetectionResult",value:function(){return this.videoDataExtractor.getDetectionResult()}},{key:"getMediaSource",value:function(){return this.videoSource}},{key:"renderLoopAsync",value:(t=i(k.mark((function e(){var t,r,n=this;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.videoSource||I("Requires a VideoSource"),e.next=3,this.videoDataExtractor.getOutputAsync();case 3:if(!(t=e.sent)){e.next=11;break}return this.videoDataExtractor.tracker.setLightingCheckThreshold(this.lightingThreshold),this.mediaData=t,e.next=9,this.render(this.mediaData);case 9:this.mediaData=null,null!==t.detectionResult&&t.detectionResult.isBadLighting&&(i="badLighting",console.log(i),this.eventQueue.badLighting||(this.eventQueue.badLighting=Promise.resolve()),this.eventQueue.badLighting=this.eventQueue.badLighting.then((function(){n.fireEventListener("badLighting")})));case 11:r=this.renderLoopAsync.bind(this),this.liveProcessId=setTimeout(r,25);case 13:case"end":return e.stop()}var i}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"processVideo",value:function(){var e=this;return this.renderLoopActive?Promise.reject(new Error("A processVideo loop is already active")):this.videoDataExtractor.setSource(this.getSource()).then((function(){var t=e.videoDataExtractor.getWidth(),r=e.videoDataExtractor.getHeight();return e.makeupRenderer.resize(t,r),e.renderLoopActive=!0,e.renderLoopAsync()}))}},{key:"stopProcessingVideo",value:function(){window.clearTimeout(this.liveProcessId),this.liveProcessId=-1,this.renderLoopActive=!1}}]),n}(ce);function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var He=function(e){d(o,e);var t,r,n=ze(o);function o(){var e;return a(this,o),(e=n.call(this)).imageSource=null,e.canvasDataExtractor=null,e.requestFrame=null,e}return s(o,[{key:"destroy",value:function(){l(u(o.prototype),"destroy",this).call(this),this.imageSource.destroy(),this.canvasDataExtractor.destroy(),this.imageSource=null,this.canvasDataExtractor=null,cancelAnimationFrame(this.requestFrame),this.requestFrame=null}},{key:"create",value:function(){var e=[l(u(o.prototype),"create",this).call(this)];return this.mode="photo",this.imageSource=new Fe,this.canvasDataExtractor=new Ae,e.push(this.canvasDataExtractor.create()),Promise.all(e)}},{key:"createTutorial",value:function(e,t){return this.makeupRenderer.playTutorial(e,t)}},{key:"setImage",value:function(e,t){var r=this;return r.unsetMouthOpen(),new Promise((function(n,i){r.canvasDataExtractor.setPresetDetectionResult({}),r.imageSource.setImage(e).then((function(){r.processImage().then((function(){var e=r.getDetectionResult();void 0!==t?(Object.keys(e).forEach((function(r){r in t&&(e[r]=t[r])})),r.canvasDataExtractor.setPresetDetectionResult(e),r.processImage().then((function(){n(e)}),(function(e){i(e)}))):n(e)})).catch((function(e){i(e)}))}))}))}},{key:"pauseTutorial",value:function(){this.makeupRenderer.pauseTutorial()}},{key:"resumeTutorial",value:function(){this.makeupRenderer.resumeTutorial()}},{key:"getStep",value:function(){return this.makeupRenderer.getTutorialStep()}},{key:"setStep",value:function(e){this.makeupRenderer.setTutorialStep(e)}},{key:"setPlayCount",value:function(e){this.makeupRenderer.setPlayCount(e)}},{key:"stopTutorial",value:function(){this.makeupRenderer.stopTutorial()}},{key:"setDetectionResult",value:function(e){return this.canvasDataExtractor.setPresetDetectionResult(e),this.processImage()}},{key:"getDetectionResult",value:function(){return this.canvasDataExtractor.getDetectionResult()}},{key:"getMediaSource",value:function(){return this.imageSource}},{key:"processImage",value:(r=i(k.mark((function e(){var t;return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.canvasDataExtractor.setSource(this.getSource());case 2:return this.makeupRenderer.resize(this.canvasDataExtractor.getWidth(),this.canvasDataExtractor.getHeight()),e.next=5,this.canvasDataExtractor.awaitOutput();case 5:return t=e.sent,this.requestFrame&&(cancelAnimationFrame(this.requestFrame),this.requestFrame=null),this.hasValidFace=!0,this.mediaData=t,this.makeupRenderer.setMediaData(t,!0),e.next=12,this.staticRenderLoop(this.mediaData);case 12:return e.abrupt("return",this.getDetectionResult());case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"staticRenderLoop",value:(t=i(k.mark((function e(t){return k.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.render(t);case 2:this.requestFrame=requestAnimationFrame(this.staticRenderLoop.bind(this,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(ce);function We(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}var Ve=function(){function e(t){a(this,e),this.propName=t.propName,this.defaultValue=t.default,this.strictMode=!!t.strictMode}return s(e,[{key:"getValidated",value:function(e){var t=this.getValidatedHelper(e);return null!=t?t:(this.strictMode&&I("Invalid value of ".concat(e)),this.defaultValue)}},{key:"getValidatedHelper",value:function(){I("Override please")}}]),e}(),Ue=function(e){d(r,e);var t=We(r);function r(e){var n;return a(this,r),(n=t.call(this,e)).allowed=new Set(e.allowed),n}return s(r,[{key:"getValidatedHelper",value:function(e){return this.allowed.has(e)?e:null}}]),r}(Ve),Ge=function(e){d(r,e);var t=We(r);function r(e){var n;return a(this,r),n=t.call(this,e),e.min>e.max&&I("min should be <= max"),n.min=e.min,n.max=e.max,n}return s(r,[{key:"getValidatedHelper",value:function(e){return"number"!=typeof(t=Number(e))||Number.isNaN(t)?null:Math.max(this.min,Math.min(e,this.max));var t}}]),r}(Ve),Ye=function(){function e(t){if(a(this,e),!t)throw new Error("baseImageLocation must be specified");this.baseImageLocation=t,this.embeddedAssets={"white.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQI12P4DwABAQEAG7buVgAAAABJRU5ErkJggg=="}}return s(e,[{key:"resolveImageLocation",value:function(t,r,n){if(e.isAbsoluteURL(t)||!n)return t;if(t in this.embeddedAssets)return this.embeddedAssets[t];var i=r?e.concatPaths("Glitter",t):t;return e.concatPaths(this.baseImageLocation,i)}},{key:"resolveJsonLocation",value:function(e){return e}}],[{key:"isAbsoluteURL",value:function(e){return e.startsWith("http://")||e.startsWith("https://")}},{key:"concatPaths",value:function(e,t){return e.endsWith("/")||t.startsWith("/")?e+t:"".concat(e,"/").concat(t)}}]),e}();window.VideoMakeupModule=Pe,window.PhotoMakeupModule=je,window.TutorialModule=Ne,window.StaticTutorialModule=He,window.SetValidator=Ue,window.RangeValidator=Ge,window.MakeupResourceResolver=Ye}();